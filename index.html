<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FreteManager</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
<style>
  /* Seus estilos existentes permanecem iguais - mantenha todo o CSS que vocÃª jÃ¡ tinha */
  @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500&display=swap');

  :root {
    --bg: #0a0e1a;
    --bg2: #0d1220;
    --glass: rgba(255,255,255,0.07);
    --glass-border: rgba(255,255,255,0.12);
    --glass-hover: rgba(255,255,255,0.11);
    --glass-active: rgba(255,255,255,0.18);
    --accent: #00d4ff;
    --accent2: #ff6b35;
    --accent3: #7c3aed;
    --green: #00ff88;
    --red: #ff4466;
    --yellow: #ffd93d;
    --text: #f0f4ff;
    --text2: #8892aa;
    --muted: #4a5568;
    --card-radius: 20px;
    --nav-h: 72px;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

  html { scroll-behavior: smooth; }

  body {
    font-family: 'Outfit', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    font-size: 15px;
    overflow-x: hidden;
    padding-bottom: calc(var(--nav-h) + 16px);
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background:
      radial-gradient(ellipse 80% 50% at 20% 10%, rgba(0,212,255,0.12) 0%, transparent 60%),
      radial-gradient(ellipse 60% 40% at 80% 80%, rgba(124,58,237,0.10) 0%, transparent 60%),
      radial-gradient(ellipse 40% 30% at 50% 50%, rgba(0,255,136,0.05) 0%, transparent 70%);
    pointer-events: none;
    z-index: 0;
  }

  main { position: relative; z-index: 1; padding: 16px; max-width: 600px; margin: 0 auto; }

  .glass {
    background: var(--glass);
    backdrop-filter: blur(24px) saturate(180%);
    -webkit-backdrop-filter: blur(24px) saturate(180%);
    border: 1px solid var(--glass-border);
    border-radius: var(--card-radius);
  }

  .app-header {
    position: sticky;
    top: 0;
    z-index: 200;
    padding: 12px 16px;
    background: rgba(10,14,26,0.7);
    backdrop-filter: blur(30px) saturate(200%);
    -webkit-backdrop-filter: blur(30px) saturate(200%);
    border-bottom: 1px solid var(--glass-border);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .app-logo {
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .logo-icon {
    width: 40px; height: 40px;
    background: linear-gradient(135deg, var(--accent), var(--accent3));
    border-radius: 12px;
    display: flex; align-items: center; justify-content: center;
    box-shadow: 0 4px 20px rgba(0,212,255,0.3);
    flex-shrink: 0;
  }
  .logo-icon svg {
    width: 22px; height: 22px;
    stroke: #000;
    fill: none;
    stroke-width: 2;
    stroke-linecap: round;
    stroke-linejoin: round;
  }
  .logo-text {
    font-size: 20px;
    font-weight: 800;
    letter-spacing: -0.5px;
    background: linear-gradient(135deg, #fff 30%, var(--accent));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  .logo-sub {
    font-size: 10px;
    color: var(--text2);
    margin-top: -2px;
    letter-spacing: 0.5px;
  }

  .header-avatar {
    width: 42px; height: 42px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--accent3), var(--accent));
    display: flex; align-items: center; justify-content: center;
    font-size: 20px;
    cursor: pointer;
    border: 2px solid var(--glass-border);
    transition: all .25s cubic-bezier(0.34, 1.56, 0.64, 1);
    position: relative;
    overflow: hidden;
    flex-shrink: 0;
  }
  .header-avatar:hover { border-color: var(--accent); box-shadow: 0 0 16px rgba(0,212,255,0.3); }
  .header-avatar:active { transform: scale(0.92); }
  .header-avatar img {
    width: 100%; height: 100%;
    object-fit: cover;
    border-radius: 50%;
    position: absolute; inset: 0;
  }
  .avatar-online {
    position: absolute;
    bottom: 1px; right: 1px;
    width: 11px; height: 11px;
    background: var(--green);
    border-radius: 50%;
    border: 2px solid var(--bg);
    z-index: 2;
  }
  .avatar-edit-hint {
    position: absolute; inset: 0;
    background: rgba(0,0,0,0.5);
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 14px;
    opacity: 0;
    transition: opacity .2s;
    z-index: 3;
  }
  .header-avatar:hover .avatar-edit-hint { opacity: 1; }

  .avatar-modal {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    z-index: 600;
    display: none;
    align-items: flex-start;
    justify-content: flex-end;
    padding: 68px 16px 0;
  }
  .avatar-modal.open { display: flex; }
  .avatar-modal-backdrop {
    position: fixed; inset: 0;
    background: rgba(0,0,0,0.3);
    backdrop-filter: blur(4px);
    z-index: -1;
  }
  .avatar-panel {
    background: rgba(13,18,32,0.95);
    backdrop-filter: blur(30px) saturate(200%);
    -webkit-backdrop-filter: blur(30px) saturate(200%);
    border: 1px solid var(--glass-border);
    border-radius: 20px;
    padding: 20px;
    width: 260px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.5);
    animation: fadeScaleIn .2s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  @keyframes fadeScaleIn {
    from { opacity: 0; transform: scale(0.85) translateY(-10px); }
    to   { opacity: 1; transform: scale(1) translateY(0); }
  }
  .avatar-panel-photo {
    display: flex; flex-direction: column; align-items: center; gap: 12px;
    margin-bottom: 18px; padding-bottom: 18px;
    border-bottom: 1px solid var(--glass-border);
  }
  .avatar-preview {
    width: 80px; height: 80px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--accent3), var(--accent));
    display: flex; align-items: center; justify-content: center;
    font-size: 36px;
    border: 3px solid var(--glass-border);
    overflow: hidden;
    position: relative;
  }
  .avatar-preview img { width: 100%; height: 100%; object-fit: cover; }
  .avatar-name { font-size: 16px; font-weight: 700; }
  .avatar-sub  { font-size: 12px; color: var(--text2); margin-top: -8px; }
  .avatar-action {
    display: flex; align-items: center; gap: 12px;
    padding: 12px;
    border-radius: 12px;
    cursor: pointer;
    transition: background .15s;
    font-size: 14px; font-weight: 500;
  }
  .avatar-action:hover { background: var(--glass); }
  .avatar-action:active { background: var(--glass-active); }
  .avatar-action-icon {
    width: 36px; height: 36px;
    border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    font-size: 18px;
    flex-shrink: 0;
  }
  .avatar-action-text { font-size: 13px; }
  .avatar-action-sub  { font-size: 11px; color: var(--text2); margin-top: 2px; }

  .bottom-nav {
    position: fixed;
    bottom: 0; left: 0; right: 0;
    z-index: 200;
    height: var(--nav-h);
    background: rgba(10,14,26,0.85);
    backdrop-filter: blur(30px) saturate(200%);
    -webkit-backdrop-filter: blur(30px) saturate(200%);
    border-top: 1px solid var(--glass-border);
    display: flex;
    align-items: center;
    overflow-x: auto;
    overflow-y: hidden;
    scroll-snap-type: x mandatory;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    padding: 0 8px;
    padding-bottom: env(safe-area-inset-bottom);
    gap: 2px;
  }
  .bottom-nav::-webkit-scrollbar { display: none; }

  .nav-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    padding: 8px 14px;
    border-radius: 16px;
    cursor: pointer;
    transition: all .25s cubic-bezier(0.34, 1.56, 0.64, 1);
    border: 1px solid transparent;
    background: transparent;
    min-width: 62px;
    flex-shrink: 0;
    scroll-snap-align: start;
    position: relative;
  }
  .nav-item.active {
    background: var(--glass-active);
    border-color: var(--glass-border);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
  }
  .nav-item.active .nav-icon { color: var(--accent); transform: translateY(-2px) scale(1.1); }
  .nav-item.active .nav-icon svg { stroke: var(--accent); }
  .nav-item.active .nav-label { color: var(--accent); }
  .nav-item:active { transform: scale(0.92); }
  .nav-icon {
    width: 24px; height: 24px;
    display: flex; align-items: center; justify-content: center;
    transition: all .25s cubic-bezier(0.34, 1.56, 0.64, 1);
    color: var(--text2);
  }
  .nav-icon svg {
    width: 22px; height: 22px;
    stroke: var(--text2);
    fill: none;
    stroke-width: 1.8;
    stroke-linecap: round;
    stroke-linejoin: round;
    transition: stroke .25s;
  }
  .nav-label {
    font-size: 9px;
    font-weight: 600;
    color: var(--text2);
    letter-spacing: 0.3px;
    text-transform: uppercase;
    transition: color .2s;
    white-space: nowrap;
  }
  .nav-badge {
    position: absolute;
    top: 4px; right: 8px;
    background: var(--red);
    color: #fff;
    font-size: 9px;
    font-weight: 700;
    min-width: 16px; height: 16px;
    border-radius: 8px;
    display: flex; align-items: center; justify-content: center;
    padding: 0 4px;
  }

  .page { display: none; animation: pageIn .35s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
  .page.active { display: block; }

  @keyframes pageIn {
    from { opacity: 0; transform: translateY(12px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  .page-title {
    font-size: 28px;
    font-weight: 800;
    letter-spacing: -0.5px;
    margin-bottom: 4px;
    background: linear-gradient(135deg, #fff 50%, var(--accent));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  .page-subtitle { font-size: 13px; color: var(--text2); margin-bottom: 20px; }

  .card {
    background: var(--glass);
    backdrop-filter: blur(24px) saturate(180%);
    -webkit-backdrop-filter: blur(24px) saturate(180%);
    border: 1px solid var(--glass-border);
    border-radius: var(--card-radius);
    padding: 18px;
    margin-bottom: 14px;
    transition: transform .2s, box-shadow .2s;
  }
  .card:active { transform: scale(0.99); }

  .stats-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-bottom: 16px;
  }
  .stat-card {
    background: var(--glass);
    backdrop-filter: blur(24px) saturate(180%);
    -webkit-backdrop-filter: blur(24px) saturate(180%);
    border: 1px solid var(--glass-border);
    border-radius: 18px;
    padding: 16px;
    position: relative;
    overflow: hidden;
    transition: transform .2s;
  }
  .stat-card:active { transform: scale(0.97); }
  .stat-card-glow {
    position: absolute;
    top: -20px; right: -20px;
    width: 80px; height: 80px;
    border-radius: 50%;
    opacity: 0.3;
    filter: blur(20px);
  }
  .stat-label { font-size: 11px; color: var(--text2); font-weight: 500; text-transform: uppercase; letter-spacing: 0.8px; margin-bottom: 8px; }
  .stat-value { font-size: 24px; font-weight: 800; letter-spacing: -0.5px; }
  .stat-sub { font-size: 11px; color: var(--text2); margin-top: 4px; }

  .section-title {
    font-size: 13px;
    font-weight: 700;
    color: var(--text2);
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 12px;
    margin-top: 8px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .section-title::after {
    content: '';
    flex: 1;
    height: 1px;
    background: var(--glass-border);
  }

  .delivery-row {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 14px 0;
    border-bottom: 1px solid rgba(255,255,255,0.05);
  }
  .delivery-row:last-child { border-bottom: none; }
  .delivery-dot {
    width: 10px; height: 10px;
    border-radius: 50%;
    flex-shrink: 0;
  }
  .delivery-info { flex: 1; min-width: 0; }
  .delivery-route { font-weight: 600; font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .delivery-client { font-size: 12px; color: var(--text2); margin-top: 2px; }
  .delivery-right { text-align: right; flex-shrink: 0; }
  .delivery-value { font-weight: 800; font-size: 16px; }
  .delivery-profit { font-size: 11px; color: var(--text2); }

  .badge {
    display: inline-flex; align-items: center; gap: 4px;
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 0.3px;
  }
  .badge-done    { background: rgba(0,255,136,0.15); color: var(--green); border: 1px solid rgba(0,255,136,0.3); }
  .badge-transit { background: rgba(255,107,53,0.15); color: var(--accent2); border: 1px solid rgba(255,107,53,0.3); }
  .badge-loading { background: rgba(0,212,255,0.15); color: var(--accent); border: 1px solid rgba(0,212,255,0.3); }
  .badge-sched   { background: rgba(255,217,61,0.15); color: var(--yellow); border: 1px solid rgba(255,217,61,0.3); }

  .fleet-row {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    margin-bottom: 16px;
  }
  .fleet-mini {
    background: var(--glass);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    border-radius: 16px;
    padding: 14px 10px;
    text-align: center;
    transition: all .2s;
  }
  .fleet-mini:active { transform: scale(0.95); }
  .fleet-mini-icon { font-size: 26px; margin-bottom: 6px; }
  .fleet-mini-name { font-size: 12px; font-weight: 700; }
  .fleet-mini-plate {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    color: var(--text2);
    margin-top: 3px;
    background: rgba(255,255,255,0.05);
    padding: 2px 6px;
    border-radius: 4px;
    display: inline-block;
  }
  .fleet-mini-status { font-size: 10px; margin-top: 6px; }

  .form-group { display: flex; flex-direction: column; gap: 8px; margin-bottom: 14px; }
  .form-label { font-size: 12px; font-weight: 600; color: var(--text2); text-transform: uppercase; letter-spacing: 0.8px; }
  .form-input {
    background: var(--glass);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    color: var(--text);
    padding: 14px 16px;
    border-radius: 14px;
    font-family: 'Outfit', sans-serif;
    font-size: 15px;
    outline: none;
    transition: all .2s;
    width: 100%;
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
  }
  .form-input:focus { border-color: var(--accent); background: rgba(0,212,255,0.05); box-shadow: 0 0 0 3px rgba(0,212,255,0.1); }
  .form-input::placeholder { color: var(--muted); }
  select.form-input option { background: #0d1220; color: var(--text); }
  .form-grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
  .form-grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }

  .btn {
    display: inline-flex; align-items: center; justify-content: center; gap: 8px;
    padding: 14px 24px;
    border-radius: 16px;
    border: none;
    font-family: 'Outfit', sans-serif;
    font-weight: 700;
    font-size: 15px;
    cursor: pointer;
    transition: all .25s cubic-bezier(0.34, 1.56, 0.64, 1);
    letter-spacing: 0.2px;
  }
  .btn:active { transform: scale(0.96); }
  .btn-primary {
    background: linear-gradient(135deg, var(--accent), #0096cc);
    color: #000;
    box-shadow: 0 4px 20px rgba(0,212,255,0.3);
    width: 100%;
  }
  .btn-primary:hover { box-shadow: 0 6px 28px rgba(0,212,255,0.45); transform: translateY(-1px); }
  .btn-secondary {
    background: var(--glass);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    color: var(--text);
    width: 100%;
  }
  .btn-danger {
    background: rgba(255,68,102,0.15);
    border: 1px solid rgba(255,68,102,0.3);
    color: var(--red);
    padding: 8px 14px;
    font-size: 12px;
  }
  .btn-sm { padding: 10px 16px; font-size: 13px; width: auto; }

  .timer-big {
    text-align: center;
    padding: 24px;
    background: var(--glass);
    backdrop-filter: blur(30px);
    -webkit-backdrop-filter: blur(30px);
    border: 1px solid var(--glass-border);
    border-radius: 24px;
    margin: 12px 0;
  }
  .timer-digits {
    font-size: 56px;
    font-weight: 900;
    letter-spacing: -2px;
    color: var(--accent2);
    font-family: 'JetBrains Mono', monospace;
    text-shadow: 0 0 30px rgba(255,107,53,0.4);
  }
  .timer-label { font-size: 12px; color: var(--text2); margin-top: 4px; text-transform: uppercase; letter-spacing: 1px; }

  .time-boxes {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 8px;
    margin: 12px 0;
  }
  .time-box {
    background: var(--glass);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    border-radius: 14px;
    padding: 12px 8px;
    text-align: center;
  }
  .time-box.active-border { border-color: var(--accent); box-shadow: 0 0 12px rgba(0,212,255,0.2); }
  .time-box-label { font-size: 9px; color: var(--text2); text-transform: uppercase; letter-spacing: 0.8px; margin-bottom: 5px; }
  .time-box-value { font-family: 'JetBrains Mono', monospace; font-size: 18px; font-weight: 700; color: var(--text2); }
  .time-box-value.set { color: var(--accent); }

  .table-wrap { overflow-x: auto; -webkit-overflow-scrolling: touch; border-radius: var(--card-radius); }
  table { width: 100%; border-collapse: collapse; min-width: 560px; }
  th { padding: 12px 14px; font-size: 10px; color: var(--text2); text-transform: uppercase; letter-spacing: 1px; border-bottom: 1px solid var(--glass-border); font-weight: 600; text-align: left; background: var(--glass); }
  td { padding: 13px 14px; font-size: 13px; border-bottom: 1px solid rgba(255,255,255,0.04); }
  tr:hover td { background: rgba(255,255,255,0.02); }
  tr:last-child td { border-bottom: none; }

  .rank-item {
    display: flex; align-items: center; gap: 12px;
    padding: 13px 0;
    border-bottom: 1px solid rgba(255,255,255,0.05);
  }
  .rank-item:last-child { border-bottom: none; }
  .rank-num { font-size: 22px; font-weight: 900; width: 28px; text-align: center; color: var(--muted); font-family: 'JetBrains Mono', monospace; }
  .rank-item:nth-child(1) .rank-num { color: var(--yellow); text-shadow: 0 0 10px rgba(255,217,61,.5); }
  .rank-item:nth-child(2) .rank-num { color: var(--text2); }
  .rank-item:nth-child(3) .rank-num { color: var(--accent2); }
  .rank-info { flex: 1; }
  .rank-name { font-weight: 600; font-size: 14px; }
  .rank-sub  { font-size: 12px; color: var(--text2); margin-top: 2px; }
  .rank-value { font-size: 16px; font-weight: 800; color: var(--green); }

  .frota-card {
    background: var(--glass);
    backdrop-filter: blur(24px) saturate(180%);
    -webkit-backdrop-filter: blur(24px) saturate(180%);
    border: 1px solid var(--glass-border);
    border-radius: 22px;
    overflow: hidden;
    margin-bottom: 14px;
    transition: transform .2s;
  }
  .frota-card:active { transform: scale(0.99); }
  .frota-card-top {
    display: flex; align-items: center; gap: 14px;
    padding: 18px;
    border-bottom: 1px solid rgba(255,255,255,0.05);
  }
  .frota-card-icon {
    width: 54px; height: 54px;
    border-radius: 16px;
    background: var(--glass-hover);
    border: 1px solid var(--glass-border);
    display: flex; align-items: center; justify-content: center;
    font-size: 26px;
    flex-shrink: 0;
  }
  .frota-card-name { font-size: 18px; font-weight: 800; }
  .frota-card-year { font-size: 12px; color: var(--text2); }
  .frota-plate {
    margin-left: auto;
    background: #f8f4e0;
    color: #111;
    font-family: 'JetBrains Mono', monospace;
    font-weight: 800;
    font-size: 13px;
    letter-spacing: 2px;
    padding: 6px 12px;
    border-radius: 8px;
    border: 2px solid #222;
    flex-shrink: 0;
  }
  .frota-specs {
    display: grid; grid-template-columns: 1fr 1fr;
    gap: 8px; padding: 14px 18px;
  }
  .frota-spec {
    background: rgba(255,255,255,0.04);
    border-radius: 12px; padding: 10px 12px;
  }
  .frota-spec-label { font-size: 10px; color: var(--text2); text-transform: uppercase; letter-spacing: .8px; margin-bottom: 4px; }
  .frota-spec-value { font-size: 16px; font-weight: 700; }
  .frota-revisao {
    margin: 0 18px 14px;
    background: rgba(255,255,255,0.04);
    border-radius: 12px; padding: 12px;
  }
  .progress-track { height: 4px; background: rgba(255,255,255,0.1); border-radius: 2px; overflow: hidden; margin: 8px 0; }
  .progress-fill  { height: 100%; border-radius: 2px; transition: width .5s; }
  .frota-footer { display: flex; gap: 8px; padding: 14px 18px; border-top: 1px solid rgba(255,255,255,0.05); }
  .frota-add-btn {
    border: 2px dashed var(--glass-border);
    border-radius: 22px;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    min-height: 160px; cursor: pointer; transition: all .2s;
    color: var(--text2); font-weight: 700; gap: 10px; font-size: 15px;
    background: transparent; margin-bottom: 14px;
  }
  .frota-add-btn:active { background: var(--glass); border-color: var(--accent); color: var(--accent); }
  .frota-add-plus { font-size: 32px; line-height: 1; }

  .alert-strip {
    display: flex; align-items: center; gap: 10px;
    background: rgba(255,217,61,0.1);
    border: 1px solid rgba(255,217,61,0.3);
    border-radius: 14px;
    padding: 12px 14px;
    margin-bottom: 10px;
    font-size: 13px;
  }
  .alert-strip.red { background: rgba(255,68,102,0.1); border-color: rgba(255,68,102,0.3); }

  #map { width: 100%; height: 380px; border-radius: 20px; border: 1px solid var(--glass-border); background: #1a1a2e; z-index: 1; }
  .firebase-setup {
    background: var(--glass);
    backdrop-filter: blur(24px);
    -webkit-backdrop-filter: blur(24px);
    border: 1px solid var(--glass-border);
    border-radius: 22px; padding: 22px;
  }
  .firebase-setup h3 { font-size: 16px; font-weight: 800; margin-bottom: 14px; color: var(--accent); }
  .firebase-connected {
    display: flex; align-items: center; gap: 8px;
    background: rgba(0,255,136,0.1);
    border: 1px solid rgba(0,255,136,0.3);
    border-radius: 10px; padding: 10px 14px;
    font-size: 12px; color: var(--green);
  }
  .pulse-dot { width: 8px; height: 8px; background: var(--green); border-radius: 50%; animation: pulse 1.5s infinite; }
  @keyframes pulse { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:.4;transform:scale(.7)} }

  .mode-toggle { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 16px; }
  .mode-btn {
    background: var(--glass); border: 1px solid var(--glass-border);
    color: var(--text2); padding: 16px 10px; border-radius: 16px;
    cursor: pointer; font-family: 'Outfit', sans-serif; font-size: 12px;
    text-align: center; transition: all .2s; font-weight: 600;
  }
  .mode-btn.active { background: rgba(0,212,255,0.15); border-color: var(--accent); color: var(--accent); }
  .mode-icon { font-size: 24px; display: block; margin-bottom: 6px; }

  .vsel-item {
    display: flex; align-items: center; gap: 12px;
    background: var(--glass); border: 1px solid var(--glass-border);
    border-radius: 14px; padding: 12px 14px; cursor: pointer;
    transition: all .2s; margin-bottom: 8px; font-size: 13px;
  }
  .vsel-item.selected { border-color: var(--accent); background: rgba(0,212,255,0.08); }
  .vsel-dot { width: 10px; height: 10px; border-radius: 50%; background: var(--muted); flex-shrink: 0; }
  .vsel-item.selected .vsel-dot { background: var(--accent); animation: pulse 1.5s infinite; }
  .vsel-info { flex: 1; }
  .vsel-name { font-weight: 600; }
  .vsel-plate { font-size: 11px; color: var(--text2); font-family: 'JetBrains Mono', monospace; }

  .stats-row-rastreio { display: grid; grid-template-columns: repeat(3,1fr); gap: 8px; margin: 12px 0; }
  .mini-stat { background: var(--glass); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid var(--glass-border); border-radius: 14px; padding: 12px; text-align: center; }
  .mini-stat-label { font-size: 9px; color: var(--text2); text-transform: uppercase; letter-spacing: .8px; margin-bottom: 4px; }
  .mini-stat-value { font-size: 16px; font-weight: 800; color: var(--accent2); font-family: 'JetBrains Mono', monospace; }

  .tracking-btn { width: 100%; padding: 16px; font-size: 15px; border-radius: 16px; }
  .tracking-btn.stop { background: linear-gradient(135deg, var(--red), #cc0033) !important; color: #fff !important; box-shadow: 0 4px 20px rgba(255,68,102,0.35) !important; }

  .modal-overlay {
    display: none; position: fixed; inset: 0;
    background: rgba(0,0,0,.6); z-index: 500;
    align-items: flex-end; justify-content: center;
    backdrop-filter: blur(8px);
  }
  .modal-overlay.open { display: flex; }
  .modal {
    background: #0d1220;
    border: 1px solid var(--glass-border);
    border-radius: 28px 28px 0 0;
    padding: 24px 20px;
    width: 100%; max-width: 600px;
    max-height: 92vh; overflow-y: auto;
    animation: slideUp .3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }
  @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
  .modal-handle { width: 40px; height: 4px; background: var(--glass-border); border-radius: 2px; margin: 0 auto 20px; }
  .modal-title { font-size: 20px; font-weight: 800; margin-bottom: 18px; }
  .modal-actions { display: flex; gap: 10px; margin-top: 20px; }

  .setup-step { display: flex; gap: 10px; margin-bottom: 12px; font-size: 13px; color: var(--text2); line-height: 1.6; }
  .setup-num { background: var(--accent); color: #000; font-weight: 800; font-size: 10px; width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 2px; }
  .firebase-input-group { display: flex; flex-direction: column; gap: 8px; margin-top: 14px; }
  .firebase-input-group label { font-size: 11px; color: var(--text2); text-transform: uppercase; letter-spacing: .8px; }

  .no-data { text-align: center; padding: 40px 20px; color: var(--text2); font-size: 13px; }
  .no-data-icon { font-size: 40px; margin-bottom: 10px; }

  .custo-panel { background:rgba(0,0,0,0.2); border:1px solid var(--glass-border); border-radius:16px; overflow:hidden; margin-top:8px; }
  .custo-panel-header { display:flex; justify-content:space-between; align-items:center; padding:12px 14px; border-bottom:1px solid var(--glass-border); font-size:11px; font-weight:700; text-transform:uppercase; letter-spacing:.8px; color:var(--text2); }
  .custo-item { display:flex; align-items:center; gap:10px; padding:11px 14px; border-bottom:1px solid rgba(255,255,255,0.04); font-size:13px; }
  .custo-item:last-child { border-bottom:none; }
  .custo-item-icon { width:32px; height:32px; border-radius:9px; display:flex; align-items:center; justify-content:center; font-size:15px; flex-shrink:0; }
  .custo-item-name { flex:1; font-weight:500; }
  .custo-item-sub { font-size:10px; color:var(--muted); margin-top:1px; }
  .custo-item-val { font-family:'JetBrains Mono',monospace; font-weight:700; font-size:14px; }
  .custo-item-input { width:90px; background:rgba(255,255,255,0.07); border:1px solid var(--glass-border); border-radius:8px; color:var(--text); padding:6px 10px; font-size:13px; font-family:'Outfit',sans-serif; outline:none; text-align:right; transition:border-color .2s; }
  .custo-item-input:focus { border-color:var(--accent); }
  .custo-toggle { background:rgba(255,255,255,0.05); border:1px solid var(--glass-border); border-radius:8px; width:28px; height:28px; display:flex; align-items:center; justify-content:center; cursor:pointer; font-size:12px; flex-shrink:0; transition:all .2s; color:var(--text2); }
  .custo-toggle.on { background:rgba(0,212,255,0.15); border-color:var(--accent); color:var(--accent); }
  .custo-total-row { display:flex; justify-content:space-between; align-items:center; padding:14px; background:rgba(255,255,255,0.03); border-top:1px solid var(--glass-border); }
  .custo-total-label { font-size:12px; font-weight:700; color:var(--text2); text-transform:uppercase; letter-spacing:.8px; }
  .custo-total-val { font-size:22px; font-weight:900; color:var(--accent2); font-family:'JetBrains Mono',monospace; }
  .lucro-preview { display:flex; justify-content:space-between; align-items:center; padding:14px 16px; background:rgba(0,255,136,0.06); border:1px solid rgba(0,255,136,0.2); border-radius:14px; margin-top:10px; }
  .lucro-preview.negativo { background:rgba(255,68,102,0.06); border-color:rgba(255,68,102,0.2); }
  .lucro-preview-label { font-size:12px; font-weight:700; color:var(--text2); text-transform:uppercase; letter-spacing:.8px; }
  .lucro-preview-val { font-size:22px; font-weight:900; font-family:'JetBrains Mono',monospace; }
  .config-combustivel { display:flex; align-items:center; gap:10px; padding:10px 14px; background:rgba(255,107,53,0.08); border:1px solid rgba(255,107,53,0.2); border-radius:12px; margin-bottom:14px; font-size:12px; }

  .checkin-card {
    background: var(--glass);
    backdrop-filter: blur(24px) saturate(180%);
    -webkit-backdrop-filter: blur(24px) saturate(180%);
    border: 1px solid var(--glass-border);
    border-radius: 22px;
    padding: 20px;
    margin-bottom: 14px;
  }
  .checkin-route { font-size: 18px; font-weight: 800; letter-spacing: -0.3px; }
  .checkin-sub { font-size: 13px; color: var(--text2); margin-top: 4px; }
  .action-row { display: flex; gap: 8px; margin-top: 14px; flex-wrap: wrap; }

  .revisao-badge-ok   { color: var(--green); font-size: 12px; font-weight: 600; }
  .revisao-badge-warn { color: var(--yellow); font-size: 12px; font-weight: 600; }
  .revisao-badge-late { color: var(--red); font-size: 12px; font-weight: 600; }

  .entrega-disponivel {
    background: var(--glass);
    backdrop-filter: blur(24px) saturate(180%);
    -webkit-backdrop-filter: blur(24px) saturate(180%);
    border: 1px solid var(--glass-border);
    border-radius: 20px;
    padding: 18px;
    margin-bottom: 12px;
    cursor: pointer;
    transition: all .2s;
    position: relative;
    overflow: hidden;
  }
  .entrega-disponivel:hover { border-color: var(--accent); background: rgba(0,212,255,0.05); }
  .entrega-disponivel:active { transform: scale(0.99); }
  .entrega-disponivel.selecionada { border-color: var(--accent); background: rgba(0,212,255,0.08); box-shadow: 0 0 20px rgba(0,212,255,0.15); }

  .entrega-rota { font-size: 17px; font-weight: 800; letter-spacing: -0.3px; margin-bottom: 6px; }
  .entrega-tags { display: flex; gap: 6px; flex-wrap: wrap; margin-top: 8px; }
  .entrega-tag { 
    background: rgba(255,255,255,0.07); 
    border: 1px solid var(--glass-border);
    border-radius: 20px; padding: 3px 10px; 
    font-size: 11px; color: var(--text2); 
  }

  .viagem-etapas {
    display: flex;
    flex-direction: column;
    gap: 0;
    margin: 16px 0;
    position: relative;
  }
  .viagem-etapas::before {
    content: '';
    position: absolute;
    left: 19px; top: 24px; bottom: 24px;
    width: 2px;
    background: linear-gradient(to bottom, var(--accent), var(--accent2), var(--green));
    opacity: 0.3;
    z-index: 0;
  }
  .etapa {
    display: flex;
    gap: 14px;
    align-items: flex-start;
    padding: 14px 0;
    position: relative;
    z-index: 1;
  }
  .etapa-icon {
    width: 40px; height: 40px;
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 18px;
    flex-shrink: 0;
    border: 2px solid;
    transition: all .3s;
  }
  .etapa-icon.pendente  { background: rgba(255,255,255,0.05); border-color: var(--glass-border); color: var(--muted); }
  .etapa-icon.ativo     { background: rgba(0,212,255,0.15); border-color: var(--accent); color: var(--accent); box-shadow: 0 0 16px rgba(0,212,255,0.3); }
  .etapa-icon.feito     { background: rgba(0,255,136,0.15); border-color: var(--green); color: var(--green); }
  .etapa-body { flex: 1; }
  .etapa-titulo { font-size: 14px; font-weight: 700; margin-bottom: 2px; }
  .etapa-titulo.pendente { color: var(--muted); }
  .etapa-titulo.ativo    { color: var(--text); }
  .etapa-titulo.feito    { color: var(--green); }
  .etapa-hora { 
    font-family: 'JetBrains Mono', monospace; 
    font-size: 20px; font-weight: 700; 
    color: var(--accent); margin: 4px 0; 
    letter-spacing: -0.5px;
  }
  .etapa-hora.feito { color: var(--green); }
  .etapa-sub { font-size: 11px; color: var(--text2); }
  .etapa-input-row { display: flex; gap: 8px; margin-top: 10px; align-items: center; flex-wrap: wrap; }
  .etapa-datetime {
    background: rgba(255,255,255,0.07);
    border: 1px solid var(--glass-border);
    border-radius: 10px;
    padding: 10px 12px;
    color: var(--text);
    font-family: 'Outfit', sans-serif;
    font-size: 14px;
    flex: 1;
    outline: none;
    min-width: 0;
    transition: border-color .2s;
  }
  .etapa-datetime:focus { border-color: var(--accent); }
  .etapa-btn {
    background: linear-gradient(135deg, var(--accent), #0096cc);
    color: #000; border: none; border-radius: 10px;
    padding: 10px 16px; font-family: 'Outfit', sans-serif;
    font-weight: 700; font-size: 13px; cursor: pointer;
    transition: all .2s; white-space: nowrap; flex-shrink: 0;
  }
  .etapa-btn:active { transform: scale(0.96); }
  .etapa-btn.orange { background: linear-gradient(135deg, var(--accent2), #cc4400); }
  .etapa-btn.green  { background: linear-gradient(135deg, var(--green), #00aa55); }
  .etapa-btn.red    { background: rgba(255,68,102,0.2); border: 1px solid var(--red); color: var(--red); }

  .viagem-active-card {
    background: var(--glass);
    backdrop-filter: blur(30px) saturate(200%);
    -webkit-backdrop-filter: blur(30px) saturate(200%);
    border: 1px solid var(--accent);
    border-radius: 24px;
    padding: 20px;
    margin-bottom: 14px;
    box-shadow: 0 0 30px rgba(0,212,255,0.1);
  }
  .viagem-header {
    display: flex; align-items: flex-start; justify-content: space-between;
    margin-bottom: 16px; gap: 10px;
  }
  .viagem-rota { font-size: 20px; font-weight: 900; letter-spacing: -0.5px; }
  .viagem-cliente { font-size: 13px; color: var(--text2); margin-top: 4px; }

  .duracao-total {
    text-align: center;
    background: rgba(0,212,255,0.08);
    border: 1px solid rgba(0,212,255,0.2);
    border-radius: 14px; padding: 14px;
    margin: 14px 0;
  }
  .duracao-label { font-size: 10px; color: var(--text2); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 4px; }
  .duracao-value { font-size: 36px; font-weight: 900; color: var(--accent); font-family: 'JetBrains Mono', monospace; letter-spacing: -1px; }

  ::-webkit-scrollbar { width: 4px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--glass-border); border-radius: 2px; }

  @media (max-width: 400px) {
    .stats-grid { grid-template-columns: 1fr 1fr; }
    .stat-value { font-size: 20px; }
    .fleet-row { grid-template-columns: repeat(3,1fr); }
  }

  #auth-screen{position:fixed;inset:0;z-index:9999;background:var(--bg);display:flex;align-items:center;justify-content:center;padding:20px;overflow-y:auto}
  #auth-screen::before{content:'';position:fixed;inset:0;background:radial-gradient(ellipse 70% 50% at 20% 10%,rgba(0,212,255,.15) 0%,transparent 60%),radial-gradient(ellipse 50% 40% at 80% 80%,rgba(124,58,237,.12) 0%,transparent 60%);pointer-events:none}
  .auth-box{background:rgba(13,18,32,.97);backdrop-filter:blur(40px) saturate(200%);-webkit-backdrop-filter:blur(40px) saturate(200%);border:1px solid var(--glass-border);border-radius:28px;padding:36px 28px;width:100%;max-width:420px;position:relative;z-index:1;animation:slideUp .4s cubic-bezier(.25,.46,.45,.94)}
  .auth-logo{text-align:center;margin-bottom:28px}
  .auth-logo-icon{width:64px;height:64px;background:linear-gradient(135deg,var(--accent),var(--accent3));border-radius:20px;display:flex;align-items:center;justify-content:center;font-size:32px;margin:0 auto 14px;box-shadow:0 8px 32px rgba(0,212,255,.3)}
  .auth-logo-name{font-size:22px;font-weight:900;background:linear-gradient(135deg,#fff 40%,var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;letter-spacing:-.5px;max-width:280px;margin:0 auto;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
  .auth-logo-sub{font-size:12px;color:var(--text2);margin-top:4px}
  .auth-tabs{display:flex;gap:4px;background:rgba(255,255,255,.05);border-radius:14px;padding:4px;margin-bottom:24px}
  .auth-tab{flex:1;padding:10px;border:none;border-radius:10px;font-family:'Outfit',sans-serif;font-size:13px;font-weight:600;cursor:pointer;transition:all .2s;background:transparent;color:var(--text2)}
  .auth-tab.active{background:var(--glass-active);color:var(--text);box-shadow:0 2px 8px rgba(0,0,0,.3)}
  .auth-form{display:flex;flex-direction:column;gap:14px}
  .auth-group{display:flex;flex-direction:column;gap:6px}
  .auth-label{font-size:11px;font-weight:600;color:var(--text2);text-transform:uppercase;letter-spacing:.8px}
  .auth-input{background:rgba(255,255,255,.06);border:1px solid var(--glass-border);border-radius:14px;padding:14px 16px;color:var(--text);font-family:'Outfit',sans-serif;font-size:15px;outline:none;transition:all .2s;width:100%;-webkit-appearance:none;-moz-appearance:none;appearance:none;box-sizing:border-box}
  .auth-input:focus{border-color:var(--accent);background:rgba(0,212,255,.05);box-shadow:0 0 0 3px rgba(0,212,255,.1)}
  .auth-input::placeholder{color:var(--muted)}
  .auth-char-count{font-size:10px;color:var(--muted);text-align:right;margin-top:2px}
  .auth-char-count.warn{color:var(--yellow)}
  .auth-tipo-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .auth-tipo-btn{border:2px solid var(--glass-border);border-radius:14px;padding:16px 12px;text-align:center;cursor:pointer;transition:all .2s;background:rgba(255,255,255,.03)}
  .auth-tipo-btn.selected{border-color:var(--accent);background:rgba(0,212,255,.08)}
  .auth-tipo-icon{font-size:28px;margin-bottom:6px}
  .auth-tipo-label{font-size:13px;font-weight:700}
  .auth-tipo-sub{font-size:10px;color:var(--text2);margin-top:2px}
  .auth-btn{width:100%;padding:16px;background:linear-gradient(135deg,var(--accent),#0096cc);color:#000;border:none;border-radius:14px;font-family:'Outfit',sans-serif;font-weight:800;font-size:15px;cursor:pointer;transition:all .25s;box-shadow:0 4px 20px rgba(0,212,255,.3)}
  .auth-btn:hover{transform:translateY(-1px);box-shadow:0 6px 28px rgba(0,212,255,.45)}
  .auth-btn:active{transform:scale(.98)}
  .auth-btn:disabled{opacity:.5;pointer-events:none}
  .auth-error{background:rgba(255,68,102,.1);border:1px solid rgba(255,68,102,.3);border-radius:10px;padding:10px 14px;font-size:13px;color:var(--red);display:none;margin-bottom:4px}
  .auth-success{background:rgba(0,255,136,.1);border:1px solid rgba(0,255,136,.3);border-radius:10px;padding:10px 14px;font-size:13px;color:var(--green);display:none;margin-bottom:4px}
  .auth-spinner{display:inline-block;width:16px;height:16px;border:2px solid rgba(0,0,0,.3);border-top-color:#000;border-radius:50%;animation:spin .7s linear infinite;vertical-align:middle;margin-right:6px}
  @keyframes spin{to{transform:rotate(360deg)}}

  .func-vehicle-card{background:var(--glass);backdrop-filter:blur(24px);-webkit-backdrop-filter:blur(24px);border:1px solid var(--glass-border);border-radius:22px;overflow:hidden;margin-bottom:14px}
  .func-vehicle-top{display:flex;align-items:center;gap:14px;padding:18px;background:linear-gradient(135deg,rgba(0,212,255,.08),rgba(124,58,237,.05));border-bottom:1px solid var(--glass-border)}
  .func-vehicle-icon{width:56px;height:56px;border-radius:16px;background:rgba(0,212,255,.15);border:1px solid rgba(0,212,255,.3);display:flex;align-items:center;justify-content:center;font-size:28px}
  .func-spec-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;padding:14px 18px}
  .func-spec{background:rgba(255,255,255,.04);border-radius:12px;padding:12px}
  .func-spec-label{font-size:10px;color:var(--text2);text-transform:uppercase;letter-spacing:.8px;margin-bottom:4px}
  .func-spec-val{font-size:17px;font-weight:700}
  .func-carga-item{display:flex;align-items:center;gap:10px;padding:11px 0;border-bottom:1px solid rgba(255,255,255,.05);font-size:13px}
  .func-carga-item:last-child{border-bottom:none}
  .func-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
  .locked-overlay{position:absolute;inset:0;z-index:5;background:rgba(10,14,26,.94);backdrop-filter:blur(8px);display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:30px;border-radius:inherit}

  .func-card{background:var(--glass);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border:1px solid var(--glass-border);border-radius:18px;padding:16px 18px;margin-bottom:10px;display:flex;align-items:center;gap:14px;transition:border-color .2s}
  .func-card.inativo{opacity:.5}
  .func-avatar-sm{width:44px;height:44px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0;border:2px solid transparent}
  .func-avatar-sm.online{border-color:var(--green);box-shadow:0 0 10px rgba(0,255,136,.3)}
  .func-avatar-sm.offline{border-color:var(--glass-border)}
  .func-info{flex:1;min-width:0}
  .func-nome{font-size:14px;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .func-email{font-size:11px;color:var(--text2);margin-top:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .func-veiculo-tag{font-size:10px;color:var(--accent);margin-top:3px;font-weight:600}
  .func-status-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
  .func-status-dot.online{background:var(--green);box-shadow:0 0 6px var(--green)}
  .func-status-dot.offline{background:var(--muted)}
  .func-actions{display:flex;gap:6px;flex-shrink:0}
  .func-action-btn{width:32px;height:32px;border-radius:9px;border:none;display:flex;align-items:center;justify-content:center;font-size:14px;cursor:pointer;transition:all .2s}
  .func-action-btn.danger{background:rgba(255,68,102,.15);color:var(--red)}
  .func-action-btn.warn{background:rgba(255,217,61,.15);color:var(--yellow)}
  .func-action-btn:hover{transform:scale(1.1)}
  .equipe-stats{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-bottom:16px}
  .equipe-stat{background:var(--glass);border:1px solid var(--glass-border);border-radius:14px;padding:12px;text-align:center}
  .equipe-stat-val{font-size:22px;font-weight:900;font-family:'JetBrains Mono',monospace}
  .equipe-stat-label{font-size:10px;color:var(--text2);text-transform:uppercase;letter-spacing:.7px;margin-top:2px}
  .add-func-panel{background:rgba(0,212,255,.05);border:1px dashed rgba(0,212,255,.3);border-radius:18px;padding:20px;margin-bottom:16px}
  .add-func-panel.hidden{display:none}
  .saas-plan-banner{background:linear-gradient(135deg,rgba(124,58,237,.15),rgba(0,212,255,.1));border:1px solid rgba(124,58,237,.3);border-radius:16px;padding:16px 18px;margin-bottom:16px;display:flex;align-items:center;gap:14px}
  .plan-icon{font-size:28px;flex-shrink:0}
  .plan-info{flex:1}
  .plan-name{font-size:14px;font-weight:800}
  .plan-sub{font-size:11px;color:var(--text2);margin-top:2px}
  .plan-price{font-size:18px;font-weight:900;color:var(--accent);font-family:'JetBrains Mono',monospace;text-align:right}
  .plan-price-sub{font-size:9px;color:var(--text2);text-align:right}
  .upgrade-card {
    background: rgba(255,255,255,.04);
    border: 1px solid var(--glass-border);
    border-radius: 14px;
    padding: 13px 15px;
    cursor: pointer;
    transition: all .18s cubic-bezier(0.34,1.56,0.64,1);
  }
  .upgrade-card:hover { background: rgba(255,255,255,.07); transform: translateY(-1px); }
  .upgrade-card:active { transform: scale(0.97); }
  .upgrade-card.selected {
    background: linear-gradient(135deg,rgba(0,212,255,.12),rgba(124,58,237,.08));
    border-color: rgba(0,212,255,.5);
  }
  .upgrade-card-popular {
    background: linear-gradient(135deg,rgba(0,212,255,.08),rgba(124,58,237,.06));
    border-color: rgba(0,212,255,.25);
  }

  .checklist-item {
    display: flex;
    align-items: center;
    padding: 12px 10px;
    background: rgba(255,255,255,0.03);
    border: 1px solid var(--glass-border);
    border-radius: 12px;
    margin-bottom: 8px;
    transition: all 0.2s;
  }
  .checklist-item.ok {
    background: rgba(0,255,136,0.05);
    border-color: rgba(0,255,136,0.3);
  }
  .checklist-item.attention {
    background: rgba(255,107,53,0.05);
    border-color: rgba(255,107,53,0.3);
  }
  .checklist-icon {
    width: 36px;
    height: 36px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    margin-right: 12px;
    flex-shrink: 0;
  }
  .checklist-info {
    flex: 1;
  }
  .checklist-nome {
    font-weight: 600;
    font-size: 14px;
  }
  .checklist-desc {
    font-size: 11px;
    color: var(--text2);
    margin-top: 2px;
  }
  .checklist-status {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-left: 10px;
    flex-shrink: 0;
  }
  .status-btn {
    width: 40px;
    height: 40px;
    border-radius: 12px;
    border: 2px solid transparent;
    background: rgba(255,255,255,0.05);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    cursor: pointer;
    transition: all 0.2s;
  }
  .status-btn.ok {
    background: rgba(0,255,136,0.15);
    border-color: var(--green);
    color: var(--green);
  }
  .status-btn.attention {
    background: rgba(255,107,53,0.15);
    border-color: var(--accent2);
    color: var(--accent2);
  }
  .checklist-foto-thumb {
    width: 60px;
    height: 60px;
    border-radius: 10px;
    object-fit: cover;
    border: 2px solid var(--glass-border);
    cursor: pointer;
    transition: transform 0.2s;
  }
  .checklist-foto-thumb:hover {
    transform: scale(1.05);
    border-color: var(--accent);
  }
  .checklist-card {
    background: var(--glass);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    border-radius: 18px;
    padding: 16px;
    margin-bottom: 12px;
  }
  .checklist-card-header {
    display: flex;
    align-items: center;
    gap: 12px;
    padding-bottom: 12px;
    border-bottom: 1px solid var(--glass-border);
    margin-bottom: 12px;
  }
  .checklist-avatar {
    width: 40px;
    height: 40px;
    border-radius: 12px;
    background: linear-gradient(135deg, var(--accent3), var(--accent));
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
  }
  .checklist-items-summary {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin: 8px 0;
  }
  .checklist-item-tag {
    background: rgba(255,255,255,0.05);
    border: 1px solid var(--glass-border);
    border-radius: 20px;
    padding: 4px 10px;
    font-size: 11px;
  }
  .checklist-item-tag.ok {
    background: rgba(0,255,136,0.1);
    border-color: rgba(0,255,136,0.3);
  }
  .checklist-item-tag.attention {
    background: rgba(255,107,53,0.1);
    border-color: rgba(255,107,53,0.3);
  }
  .foto-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
    gap: 8px;
    margin-top: 10px;
  }
  .foto-grid img {
    width: 100%;
    height: 70px;
    border-radius: 8px;
    object-fit: cover;
    border: 1px solid var(--glass-border);
    cursor: pointer;
  }

  .notas-container {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-top: 5px;
  }
  .nota-item {
    display: flex;
    align-items: center;
    gap: 8px;
    background: rgba(255,255,255,0.03);
    border: 1px solid var(--glass-border);
    border-radius: 10px;
    padding: 8px 12px;
  }
  .nota-numero {
    flex: 1;
    background: transparent;
    border: none;
    color: var(--text);
    font-family: 'Outfit', sans-serif;
    font-size: 14px;
    padding: 8px 0;
    outline: none;
  }
  .nota-numero::placeholder {
    color: var(--muted);
  }
  .nota-remove {
    width: 30px;
    height: 30px;
    border-radius: 8px;
    background: rgba(255,68,102,0.1);
    border: 1px solid rgba(255,68,102,0.3);
    color: var(--red);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 16px;
    transition: all 0.2s;
  }
  .nota-remove:hover {
    background: rgba(255,68,102,0.2);
  }
  .btn-add-nota {
    background: var(--glass);
    border: 1px dashed var(--glass-border);
    border-radius: 10px;
    padding: 12px;
    color: var(--text2);
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }
  .btn-add-nota:hover {
    border-color: var(--accent);
    color: var(--accent);
    background: rgba(0,212,255,0.05);
  }
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• AUTH SCREEN â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="auth-screen">
  <div class="auth-box">
    <div class="auth-logo">
      <div class="auth-logo-icon">ðŸš›</div>
      <div class="auth-logo-name" id="auth-empresa-nome">FreteManager</div>
      <div class="auth-logo-sub">Sistema de GestÃ£o de Fretes</div>
    </div>

    <div class="auth-error" id="auth-error"></div>
    <div class="auth-success" id="auth-success"></div>

    <!-- ENTRAR -->
    <div id="auth-form-login" class="auth-form">
      <div class="auth-group">
        <label class="auth-label">E-mail</label>
        <input type="email" class="auth-input" id="l-email" placeholder="seu@email.com" autocomplete="email">
      </div>
      <div class="auth-group">
        <label class="auth-label">Senha</label>
        <input type="password" class="auth-input" id="l-senha" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password"
          onkeydown="if(event.key==='Enter')fazerLogin()">
      </div>
      <button class="auth-btn" id="btn-login" onclick="fazerLogin()">ðŸ”“ Entrar</button>
      <div style="text-align:center;margin-top:6px">
        <span style="font-size:12px;color:var(--muted)">Novo por aqui? </span>
        <span style="font-size:12px;color:var(--accent);cursor:pointer;font-weight:600" onclick="authTab('cadastro')">Criar conta de empresa</span>
      </div>
    </div>

    <!-- CADASTRO â€” somente Dono -->
    <div id="auth-form-cadastro" class="auth-form" style="display:none">
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:6px">
        <button onclick="authTab('login')" style="background:none;border:none;color:var(--text2);cursor:pointer;font-size:22px;padding:0;line-height:1">â†</button>
        <div>
          <div style="font-size:15px;font-weight:800">Criar conta de empresa</div>
          <div style="font-size:11px;color:var(--muted)">Somente para proprietÃ¡rios</div>
        </div>
      </div>
      <div class="auth-group">
        <label class="auth-label">Nome da Empresa <span style="color:var(--muted);font-size:10px">mÃ¡x. 50 caracteres</span></label>
        <input type="text" class="auth-input" id="c-empresa" placeholder="Ex: Transportes Silva Ltda"
          maxlength="50" oninput="contarEmpresa()" autocomplete="organization">
        <div class="auth-char-count" id="empresa-chars">0 / 50</div>
      </div>
      <div class="auth-group">
        <label class="auth-label">Seu nome</label>
        <input type="text" class="auth-input" id="c-nome" placeholder="Nome completo">
      </div>
      <div class="auth-group">
        <label class="auth-label">E-mail do proprietÃ¡rio</label>
        <input type="email" class="auth-input" id="c-email" placeholder="seu@email.com" autocomplete="email">
      </div>
      <div class="auth-group">
        <label class="auth-label">Senha <span style="color:var(--muted);font-size:10px">mÃ­n. 6 caracteres</span></label>
        <input type="password" class="auth-input" id="c-senha" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="new-password">
      </div>
      <div style="background:rgba(0,212,255,0.06);border:1px solid rgba(0,212,255,0.2);border-radius:12px;padding:12px 14px;font-size:12px;color:var(--text2);line-height:1.6;margin-bottom:4px">
        ðŸ‘‘ Esta conta terÃ¡ <strong style="color:var(--text)">acesso total</strong>.<br>
        FuncionÃ¡rios sÃ£o adicionados pelo painel interno.
      </div>
      <button class="auth-btn" id="btn-cadastro" onclick="fazerCadastro()">âœ… Criar conta de empresa</button>
    </div>

  </div>
</div>

<div class="app-header">
  <div class="app-logo">
    <div class="logo-icon">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M1 3h15v13H1z"/><path d="M16 8h4l3 5v3h-7V8z"/><circle cx="5.5" cy="18.5" r="2.5"/><circle cx="18.5" cy="18.5" r="2.5"/>
      </svg>
    </div>
    <div>
      <div class="logo-text" id="app-empresa-nome" style="max-width:160px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">FreteManager</div>
      <div class="logo-sub" id="app-user-tipo">GestÃ£o de Frota</div>
    </div>
  </div>
  <div style="display:flex;align-items:center;gap:10px">
    <div id="fb-sync-indicator" style="display:none;align-items:center;gap:6px;background:rgba(0,255,136,0.1);border:1px solid rgba(0,255,136,0.3);border-radius:20px;padding:5px 12px;font-size:11px;color:#00ff88;font-weight:600"></div>
    <div class="header-avatar" id="header-avatar" onclick="toggleAvatarMenu()">
      <span id="avatar-emoji">ðŸ‘¤</span>
      <div class="avatar-edit-hint">ðŸ“·</div>
      <div class="avatar-online"></div>
    </div>
    <!-- Hidden file input -->
    <input type="file" id="avatar-file-input" accept="image/*" style="display:none" onchange="onAvatarFileSelected(event)">
  </div>
</div>

<!-- AVATAR MODAL -->
<div class="avatar-modal" id="avatar-modal">
  <div class="avatar-modal-backdrop" onclick="fecharAvatarMenu()"></div>
  <div class="avatar-panel">
    <div class="avatar-panel-photo">
      <div class="avatar-preview" id="avatar-preview-big">
        <span id="avatar-preview-emoji">ðŸ‘¤</span>
      </div>
      <div class="avatar-name" id="avatar-nome-display">-</div>
      <div class="avatar-sub">fretemanager-60ef8</div>
    </div>

    <div class="avatar-action" onclick="escolherFoto()">
      <div class="avatar-action-icon" style="background:rgba(0,212,255,0.15)">ðŸ“·</div>
      <div>
        <div class="avatar-action-text">Trocar foto</div>
        <div class="avatar-action-sub">Selecionar da galeria</div>
      </div>
    </div>

    <div class="avatar-action" onclick="tirarFoto()">
      <div class="avatar-action-icon" style="background:rgba(124,58,237,0.15)">ðŸ¤³</div>
      <div>
        <div class="avatar-action-text">Tirar foto</div>
        <div class="avatar-action-sub">Usar cÃ¢mera do celular</div>
      </div>
    </div>

    <div class="avatar-action" id="avatar-remove-btn" onclick="removerFoto()" style="display:none">
      <div class="avatar-action-icon" style="background:rgba(255,68,102,0.15)">ðŸ—‘</div>
      <div>
        <div class="avatar-action-text" style="color:var(--red)">Remover foto</div>
        <div class="avatar-action-sub">Voltar ao Ã­cone padrÃ£o</div>
      </div>
    </div>

    <div style="margin-top:12px;padding-top:12px;border-top:1px solid var(--glass-border)">
      <div class="avatar-action" onclick="fazerLogout()">
        <div class="avatar-action-icon" style="background:rgba(255,68,102,0.15)">ðŸšª</div>
        <div>
          <div class="avatar-action-text" style="color:var(--red)">Sair da conta</div>
          <div class="avatar-action-sub" id="avatar-user-email">-</div>
        </div>
      </div>
      <div class="avatar-action" onclick="fecharAvatarMenu()">
        <div class="avatar-action-icon" style="background:rgba(255,255,255,0.05)">âœ•</div>
        <div class="avatar-action-text" style="color:var(--text2)">Fechar</div>
      </div>
    </div>
  </div>
</div>

<!-- BOTTOM NAV -->
<nav class="bottom-nav">
  <div class="nav-item active" id="nav-dashboard" onclick="showPage('dashboard')">
    <div class="nav-icon">
      <svg viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
    </div>
    <div class="nav-label">InÃ­cio</div>
  </div>
  <div class="nav-item" id="nav-func" onclick="showPageFunc()" style="display:none">
    <div class="nav-icon">
      <svg viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
    </div>
    <div class="nav-label">InÃ­cio</div>
  </div>
  <div class="nav-item" id="nav-nova" onclick="showPage('nova')">
    <div class="nav-icon">
      <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg>
    </div>
    <div class="nav-label">Entrega</div>
  </div>
  <div class="nav-item" id="nav-ativas" onclick="showPage('ativas')">
    <div class="nav-icon">
      <svg viewBox="0 0 24 24"><rect x="1" y="3" width="15" height="13"/><path d="M16 8h4l3 5v3h-7V8z"/><circle cx="5.5" cy="18.5" r="2.5"/><circle cx="18.5" cy="18.5" r="2.5"/></svg>
    </div>
    <div class="nav-label">Viagens</div>
    <div class="nav-badge" id="badge-ativas" style="display:none">0</div>
  </div>
  <div class="nav-item" id="nav-historico" onclick="showPage('historico')">
    <div class="nav-icon">
      <svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
    </div>
    <div class="nav-label">HistÃ³rico</div>
  </div>
  <div class="nav-item" id="nav-rankings" onclick="showPage('rankings')">
    <div class="nav-icon">
      <svg viewBox="0 0 24 24"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>
    </div>
    <div class="nav-label">Rankings</div>
  </div>
  <div class="nav-item" id="nav-frota" onclick="showPage('frota')">
    <div class="nav-icon">
      <svg viewBox="0 0 24 24"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 7V5a2 2 0 00-2-2h-4a2 2 0 00-2 2v2"/><line x1="12" y1="12" x2="12" y2="16"/><line x1="10" y1="14" x2="14" y2="14"/></svg>
    </div>
    <div class="nav-label">Frota</div>
  </div>
  <div class="nav-item" id="nav-rastreio" onclick="showPage('rastreio')">
    <div class="nav-icon">
      <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M19.07 4.93a10 10 0 010 14.14M4.93 4.93a10 10 0 000 14.14"/><path d="M16.24 7.76a6 6 0 010 8.49M7.76 7.76a6 6 0 000 8.49"/></svg>
    </div>
    <div class="nav-label">Rastreio</div>
  </div>
  <div class="nav-item" id="nav-equipe" onclick="showPage('equipe')">
    <div class="nav-icon">
      <svg viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87"/><path d="M16 3.13a4 4 0 010 7.75"/></svg>
    </div>
    <div class="nav-label">Equipe</div>
  </div>
  <!-- NOVA ABA: CHECKLISTS -->
  <div class="nav-item" id="nav-checklists" onclick="showPage('checklists')" style="display: none;">
    <div class="nav-icon">
      <svg viewBox="0 0 24 24" width="22" height="22">
        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
        <polyline points="22 4 12 14.01 9 11.01"></polyline>
      </svg>
    </div>
    <div class="nav-label">Checklists</div>
  </div>
</nav>

<main>

  <!-- DASHBOARD -->
  <div id="page-dashboard" class="page active">
    <div class="page-title" id="dash-greeting">OlÃ¡ ðŸ‘‹</div>
    <div class="page-subtitle" id="dash-date">Hoje Ã© um Ã³timo dia para faturar</div>

    <div class="stats-grid">
      <div class="stat-card dono-only">
        <div class="stat-card-glow" style="background:var(--accent)"></div>
        <div class="stat-label">Faturamento</div>
        <div class="stat-value" id="stat-faturamento" style="color:var(--accent)">R$ 0</div>
        <div class="stat-sub" id="stat-fat-sub">este mÃªs</div>
      </div>
      <div class="stat-card dono-only">
        <div class="stat-card-glow" style="background:var(--green)"></div>
        <div class="stat-label">Lucro LÃ­quido</div>
        <div class="stat-value" id="stat-lucro" style="color:var(--green)">R$ 0</div>
        <div class="stat-sub" id="stat-lucro-sub">apÃ³s custos</div>
      </div>
      <div class="stat-card">
        <div class="stat-card-glow" style="background:var(--accent2)"></div>
        <div class="stat-label">Descarga MÃ©dia</div>
        <div class="stat-value" id="stat-tempo" style="color:var(--accent2)">--</div>
        <div class="stat-sub">por cliente</div>
      </div>
      <div class="stat-card">
        <div class="stat-card-glow" style="background:var(--red)"></div>
        <div class="stat-label">Em Rota</div>
        <div class="stat-value" id="stat-ativas" style="color:var(--red)">0</div>
        <div class="stat-sub" id="stat-ativas-sub">agora</div>
      </div>
    </div>

    <div class="section-title">Frota</div>
    <div class="fleet-row" id="fleet-cards"></div>

    <div class="section-title">Ãšltimas Entregas</div>
    <div class="card">
      <div id="recent-list"><div class="no-data"><div class="no-data-icon">ðŸ“¦</div>Nenhuma entrega ainda</div></div>
    </div>
  </div>

  <!-- FUNCIONÃRIO DASHBOARD -->
<div id="page-func" class="page">
  <div class="page-title" id="func-greeting">OlÃ¡ ðŸ‘‹</div>
  <div class="page-subtitle" id="func-date"></div>

  <div id="func-actions-container" style="margin: 20px 0;">
    <button onclick="showPage('ativas')" class="btn-primary" style="
      width: 100%; 
      padding: 22px; 
      border-radius: 18px; 
      border: none; 
      background: var(--accent); 
      color: white; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      gap: 15px; 
      font-weight: 800; 
      font-size: 16px; 
      cursor: pointer; 
      box-shadow: 0 10px 20px rgba(0,0,0,0.15);
      transition: transform 0.2s;
    ">
      <span style="font-size: 24px;">ðŸ“¦</span> 
      SELECIONAR CARGAS DISPONÃVEIS
    </button>
  </div>

  <div class="card" id="func-selecao-veiculo">
    <div class="form-label" style="margin-bottom:10px; font-weight:700; color:var(--text2)">ðŸš— SEU VEÃCULO ATUAL</div>
    <select id="func-veiculo-select" class="form-input" onchange="funcSelecionarVeiculo()">
      <option value="">Selecione sua placa...</option>
    </select>
  </div>

  <div id="func-veiculo-info" style="display:none">
    <div class="func-vehicle-card">
      <div class="func-vehicle-top">
        <div class="func-vehicle-icon">ðŸš›</div>
        <div style="flex:1">
          <div style="font-size:18px;font-weight:900" id="fv-nome">-</div>
          <div style="font-size:12px;color:var(--text2);margin-top:2px" id="fv-ano">-</div>
          <div style="display:inline-block;background:rgba(255,255,255,.1);border-radius:6px;padding:3px 10px;font-family:'JetBrains Mono',monospace;font-size:13px;font-weight:700;margin-top:6px" id="fv-placa">-</div>
        </div>
        <button onclick="funcLimparVeiculo()" style="background:rgba(255,255,255,0.05); border:1px solid var(--glass-border); border-radius:8px; color:var(--text); padding:5px 10px; font-size:11px; cursor:pointer">Trocar</button>
      </div>
      
      <div class="func-spec-grid">
        <div class="func-spec">
          <div class="func-spec-label">â›½ Consumo</div>
          <div class="func-spec-val" id="fv-consumo">-</div>
        </div>
        <div class="func-spec">
          <div class="func-spec-label">ðŸ”§ PrÃ³x. RevisÃ£o</div>
          <div class="func-spec-val" id="fv-revisao">-</div>
        </div>
        <div class="func-spec">
          <div class="func-spec-label">ðŸ“¦ Fretes realizados</div>
          <div class="func-spec-val" id="fv-fretes">-</div>
        </div>
        <div class="func-spec">
          <div class="func-spec-label">ðŸ’¸ Gastos extras</div>
          <div class="func-spec-val" id="fv-gastos">-</div>
        </div>
      </div>
    </div>

    <!-- BOTÃƒO DE CHECKLIST DO VEÃCULO -->
    <div id="checklist-button-container" style="margin: 16px 0; display: none;">
      <button class="btn btn-primary" onclick="abrirChecklistVeiculo()" style="width: 100%; padding: 16px; background: linear-gradient(135deg, var(--accent3), var(--accent));">
        <span style="display: flex; align-items: center; justify-content: center; gap: 10px;">
          <span style="font-size: 22px;">ðŸ”§</span>
          <span style="font-weight: 800;">FAZER CHECKLIST DO VEÃCULO</span>
        </span>
      </button>
      <div style="font-size: 11px; color: var(--text2); margin-top: 6px; text-align: center;">
        Ãšltimo checklist: <span id="ultimo-checklist-data">â€”</span>
      </div>
    </div>

    <div class="card">
      <div style="font-size:13px;font-weight:700;margin-bottom:12px;color:var(--text2);text-transform:uppercase;letter-spacing:.8px">ðŸ“¦ HistÃ³rico Recente</div>
      <div id="func-cargas-list">
        <div class="no-data" style="padding:20px 0">Nenhuma carga realizada</div>
      </div>
    </div>
  </div>
</div>

  <!-- EQUIPE (DONO ONLY) - CORRIGIDO -->
  <div id="page-equipe" class="page">
    <div class="page-title">Minha Equipe</div>
    <div class="page-subtitle">Gerencie acesso dos funcionÃ¡rios</div>

    <div class="saas-plan-banner" id="plano-banner">
      <div class="plan-icon">âš¡</div>
      <div class="plan-info" style="flex:1">
        <div style="display:flex;align-items:center;justify-content:space-between;gap:8px">
          <div class="plan-name" id="plano-nome">Plano BÃ¡sico</div>
          <div class="plan-price" id="plano-preco" style="font-size:15px">R$ 97<span style="font-size:9px;color:var(--text2);font-weight:400">/mÃªs</span></div>
        </div>
        <div class="plan-sub" id="plano-desc" style="margin-bottom:8px">0 / 3 motoristas</div>
        <div style="background:rgba(255,255,255,0.08);border-radius:6px;height:6px;overflow:hidden">
          <div id="plano-barra" style="height:100%;border-radius:6px;background:linear-gradient(90deg,var(--accent),var(--accent3));transition:width .4s;width:0%"></div>
        </div>
        <div id="plano-upgrade-hint" style="display:none;margin-top:8px">
          <button onclick="abrirModalUpgrade()" style="width:100%;padding:8px;border-radius:10px;border:none;background:linear-gradient(135deg,var(--accent2),#ff3d6b);color:#fff;font-weight:700;font-size:12px;cursor:pointer;letter-spacing:.3px">
            ðŸš€ Fazer upgrade do plano
          </button>
        </div>
      </div>
    </div>

    <!-- Modal upgrade -->
    <div id="modal-upgrade" style="display:none;position:fixed;inset:0;z-index:900;background:rgba(0,0,0,.6);backdrop-filter:blur(8px);align-items:center;justify-content:center;padding:20px">
      <div style="background:#0d1220;border:1px solid var(--glass-border);border-radius:24px;padding:28px;max-width:380px;width:100%;box-shadow:0 30px 80px rgba(0,0,0,.6);animation:fadeScaleIn .25s cubic-bezier(0.34,1.56,0.64,1)">
        <div style="text-align:center;margin-bottom:20px">
          <div style="font-size:40px;margin-bottom:10px">ðŸš€</div>
          <div style="font-size:20px;font-weight:900;margin-bottom:6px">Limite atingido</div>
          <div style="font-size:13px;color:var(--text2);line-height:1.6">VocÃª atingiu o nÃºmero mÃ¡ximo de motoristas do seu plano atual. FaÃ§a o upgrade para continuar crescendo.</div>
        </div>
        <div style="display:flex;flex-direction:column;gap:8px;margin-bottom:20px;max-height:55vh;overflow-y:auto;padding-right:2px" id="upgrade-cards-list">

          <div id="upgrade-card-solo" class="upgrade-card" onclick="selecionarPlanoUpgrade('solo',this)">
            <div style="display:flex;align-items:center;justify-content:space-between">
              <div>
                <div style="font-size:13px;font-weight:800">ðŸš— Solo</div>
                <div style="font-size:11px;color:var(--text2);margin-top:2px">1 motorista</div>
              </div>
              <div style="text-align:right">
                <div style="font-size:17px;font-weight:900;color:var(--accent)">R$ 49</div>
                <div style="font-size:9px;color:var(--text2)">/mÃªs</div>
              </div>
            </div>
          </div>

          <div id="upgrade-card-basico" class="upgrade-card" onclick="selecionarPlanoUpgrade('basico',this)">
            <div style="display:flex;align-items:center;justify-content:space-between">
              <div>
                <div style="font-size:13px;font-weight:800">ðŸ“¦ BÃ¡sico</div>
                <div style="font-size:11px;color:var(--text2);margin-top:2px">AtÃ© 3 motoristas</div>
              </div>
              <div style="text-align:right">
                <div style="font-size:17px;font-weight:900;color:var(--accent)">R$ 79</div>
                <div style="font-size:9px;color:var(--text2)">/mÃªs</div>
              </div>
            </div>
          </div>

          <div id="upgrade-card-pro" class="upgrade-card upgrade-card-popular" onclick="selecionarPlanoUpgrade('pro',this)">
            <div style="display:flex;align-items:center;justify-content:space-between">
              <div>
                <div style="font-size:13px;font-weight:800">âš¡ Pro <span style="font-size:9px;font-weight:700;background:rgba(0,212,255,.2);color:var(--accent);padding:2px 7px;border-radius:20px;margin-left:5px">POPULAR</span></div>
                <div style="font-size:11px;color:var(--text2);margin-top:2px">AtÃ© 5 motoristas</div>
              </div>
              <div style="text-align:right">
                <div style="font-size:17px;font-weight:900;color:var(--accent)">R$ 119</div>
                <div style="font-size:9px;color:var(--text2)">/mÃªs</div>
              </div>
            </div>
          </div>

          <div id="upgrade-card-empresa" class="upgrade-card" onclick="selecionarPlanoUpgrade('empresa',this)">
            <div style="display:flex;align-items:center;justify-content:space-between">
              <div>
                <div style="font-size:13px;font-weight:800">ðŸ—ï¸ Empresa</div>
                <div style="font-size:11px;color:var(--text2);margin-top:2px">AtÃ© 10 motoristas</div>
              </div>
              <div style="text-align:right">
                <div style="font-size:17px;font-weight:900;color:var(--accent)">R$ 179</div>
                <div style="font-size:9px;color:var(--text2)">/mÃªs</div>
              </div>
            </div>
          </div>

          <div id="upgrade-card-business" class="upgrade-card" onclick="selecionarPlanoUpgrade('business',this)">
            <div style="display:flex;align-items:center;justify-content:space-between">
              <div>
                <div style="font-size:13px;font-weight:800">ðŸ¢ Business</div>
                <div style="font-size:11px;color:var(--text2);margin-top:2px">AtÃ© 15 motoristas</div>
              </div>
              <div style="text-align:right">
                <div style="font-size:17px;font-weight:900;color:var(--accent)">R$ 249</div>
                <div style="font-size:9px;color:var(--text2)">/mÃªs</div>
              </div>
            </div>
          </div>

        </div>
        <div style="display:flex;gap:10px">
          <button onclick="fecharModalUpgrade()" style="flex:1;padding:13px;border-radius:14px;border:1px solid var(--glass-border);background:transparent;color:var(--text2);cursor:pointer;font-size:14px">Agora nÃ£o</button>
          <button onclick="irParaUpgrade()" style="flex:1;padding:13px;border-radius:14px;border:none;background:linear-gradient(135deg,var(--accent),var(--accent3));color:#000;font-weight:800;font-size:14px;cursor:pointer">Ver planos</button>
        </div>
      </div>
    </div>

    <div class="equipe-stats">
      <div class="equipe-stat">
        <div class="equipe-stat-val" id="eq-total">0</div>
        <div class="equipe-stat-label">FuncionÃ¡rios</div>
      </div>
      <div class="equipe-stat">
        <div class="equipe-stat-val" style="color:var(--green)" id="eq-online">0</div>
        <div class="equipe-stat-label">Online agora</div>
      </div>
      <div class="equipe-stat">
        <div class="equipe-stat-val" style="color:var(--accent2)" id="eq-custo">R$97</div>
        <div class="equipe-stat-label">Plano/mÃªs</div>
      </div>
    </div>

    <div style="margin-bottom:12px">
      <button class="btn btn-primary" onclick="toggleAddFunc()" id="btn-open-add-func" style="width:100%">ï¼‹ Adicionar motorista</button>
    </div>

    <div class="add-func-panel hidden" id="add-func-panel">
      <div style="font-size:14px;font-weight:800;margin-bottom:14px;color:var(--accent)">ðŸ‘· Novo funcionÃ¡rio</div>
      <div class="form-group">
        <div class="form-label">Nome completo</div>
        <input type="text" class="form-input" id="nf-nome" placeholder="Nome do funcionÃ¡rio">
      </div>
      <div class="form-group">
        <div class="form-label">E-mail de acesso</div>
        <input type="email" class="form-input" id="nf-email" placeholder="email@exemplo.com">
      </div>
      <div class="form-group">
        <div class="form-label">Senha inicial</div>
        <input type="password" class="form-input" id="nf-senha" placeholder="MÃ­nimo 6 caracteres">
      </div>
      <div style="background:rgba(255,217,61,.08);border:1px solid rgba(255,217,61,.2);border-radius:10px;padding:10px 14px;font-size:12px;color:var(--text2);margin-bottom:12px;line-height:1.6">
        ðŸ’¡ O funcionÃ¡rio usarÃ¡ este e-mail e senha para entrar.
      </div>
      <div style="display:flex;gap:8px">
        <button class="btn btn-secondary" onclick="toggleAddFunc()">Cancelar</button>
        <button class="btn btn-primary" style="flex:1" id="btn-add-func" onclick="criarFuncionario()">âœ… Criar acesso</button>
      </div>
    </div>

    <div id="equipe-lista">
      <div class="no-data"><div class="no-data-icon">ðŸ‘¥</div>Nenhum funcionÃ¡rio cadastrado ainda.</div>
    </div>
  </div>

  <!-- NOVA ENTREGA - MODIFICADA -->
  <div id="page-nova" class="page">
    <div class="page-title">Nova Entrega</div>
    <div class="page-subtitle">Registre os dados do frete</div>

    <div class="config-combustivel">
      <span style="font-size:18px">â›½</span>
      <div style="flex:1">
        <div style="font-weight:700;color:var(--accent2)">PreÃ§o do combustÃ­vel</div>
        <div style="color:var(--muted);font-size:11px">Usado para calcular custo automaticamente</div>
      </div>
      <div style="display:flex;align-items:center;gap:6px">
        <span style="color:var(--muted);font-size:12px">R$</span>
        <input type="number" id="cfg-preco-combustivel" class="custo-item-input"
          style="width:70px" step="0.01" placeholder="6,00"
          oninput="salvarConfigCusto(); recalcularCusto()">
        <span style="color:var(--muted);font-size:11px">/L</span>
      </div>
    </div>

    <div class="card">
      <div class="form-grid-2">
        <div class="form-group">
          <div class="form-label">Data</div>
          <input type="date" id="f-data" class="form-input">
        </div>
        <div class="form-group">
          <div class="form-label">Status</div>
          <select id="f-status" class="form-input">
            <option value="agendado">âœ… DisponÃ­vel</option>
            <option value="em_rota">ðŸš€ Saiu agora</option>
          </select>
        </div>
      </div>

      <!-- NOVO: Notas Fiscais (substitui veÃ­culo) -->
      <div class="form-group">
        <div class="form-label" style="display: flex; align-items: center; gap: 8px;">
          <span>ðŸ“„</span> Notas Fiscais
          <span style="font-size: 10px; color: var(--muted); font-weight: 400;">(adicione uma ou mais notas)</span>
        </div>
        <div id="notas-fiscais-container" class="notas-container">
          <!-- Campos de nota serÃ£o adicionados aqui via JS -->
        </div>
        <button type="button" class="btn-add-nota" onclick="adicionarCampoNota()">
          <span style="font-size: 18px;">+</span> Adicionar nota fiscal
        </button>
        <input type="hidden" id="f-notas" value="[]">
      </div>

      <div class="form-grid-2">
        <div class="form-group">
          <div class="form-label">Origem</div>
          <input type="text" id="f-origem" class="form-input" placeholder="Cidade / Bairro">
        </div>
        <div class="form-group">
          <div class="form-label">Destino</div>
          <input type="text" id="f-destino" class="form-input" placeholder="Cidade / Bairro">
        </div>
      </div>

      <div class="form-grid-2">
        <div class="form-group">
          <div class="form-label">Cliente</div>
          <input type="text" id="f-cliente" class="form-input" placeholder="Nome do cliente">
        </div>
        <div class="form-group">
          <div class="form-label">Tipo de Carga</div>
          <input type="text" id="f-carga" class="form-input" placeholder="Ex: EletrÃ´nicos">
        </div>
      </div>

      <!-- NOVOS CAMPOS: Peso e Embalagem -->
      <div class="form-grid-3">
        <div class="form-group">
          <div class="form-label">âš–ï¸ Peso (kg)</div>
          <input type="number" id="f-peso" class="form-input" placeholder="Ex: 500" step="0.1" min="0">
        </div>
        <div class="form-group">
          <div class="form-label">ðŸ“¦ Tipo Embalagem</div>
          <select id="f-embalagem" class="form-input">
            <option value="">Selecione...</option>
            <option value="Caixa">Caixa</option>
            <option value="Palete">Palete</option>
            <option value="Saco">Saco</option>
            <option value="Tambor">Tambor</option>
            <option value="Big Bag">Big Bag</option>
            <option value="Container">Container</option>
            <option value="Outros">Outros</option>
          </select>
        </div>
        <div class="form-group">
          <div class="form-label">ðŸ• HorÃ¡rio Receb.</div>
          <input type="time" id="f-horario-recebimento" class="form-input">
        </div>
      </div>

      <div class="form-grid-2">
        <div class="form-group">
          <div class="form-label">DistÃ¢ncia (km)</div>
          <input type="number" id="f-km" class="form-input" placeholder="km total" oninput="recalcularCusto()">
        </div>
        <div class="form-group" id="campo-valor-frete">
          <div class="form-label">Valor do Frete (R$)</div>
          <input type="number" id="f-valor" class="form-input" placeholder="0,00" step="0.01" oninput="recalcularCusto()">
        </div>
      </div>

      <div class="form-label" style="margin-bottom:8px">ðŸ’° ComposiÃ§Ã£o de Custo</div>
      <div class="custo-panel">
        <div class="custo-panel-header">
          <span>Item</span><span>Ativo</span><span>Valor</span>
        </div>
        <div class="custo-item">
          <div class="custo-item-icon" style="background:rgba(255,107,53,0.15)">â›½</div>
          <div style="flex:1">
            <div class="custo-item-name">CombustÃ­vel</div>
            <div class="custo-item-sub" id="custo-comb-sub">Informe distÃ¢ncia</div>
          </div>
          <div class="custo-toggle on" id="toggle-comb" onclick="toggleCusto('comb')">âœ“</div>
          <div class="custo-item-val" id="val-comb" style="color:var(--accent2);width:80px;text-align:right">R$ --</div>
        </div>
        <div class="custo-item">
          <div class="custo-item-icon" style="background:rgba(255,217,61,0.15)">ðŸ›£</div>
          <div style="flex:1">
            <div class="custo-item-name">PedÃ¡gio</div>
            <div class="custo-item-sub">Valor fixo por viagem</div>
          </div>
          <div class="custo-toggle on" id="toggle-pedagio" onclick="toggleCusto('pedagio')">âœ“</div>
          <input type="number" class="custo-item-input" id="val-pedagio" placeholder="0,00" oninput="recalcularCusto()">
        </div>
        <div class="custo-item">
          <div class="custo-item-icon" style="background:rgba(124,58,237,0.15)">ðŸ‘¤</div>
          <div style="flex:1">
            <div class="custo-item-name">DiÃ¡ria do motorista</div>
            <div class="custo-item-sub">Valor fixo por entrega</div>
          </div>
          <div class="custo-toggle" id="toggle-diaria" onclick="toggleCusto('diaria')">+</div>
          <input type="number" class="custo-item-input" id="val-diaria" placeholder="0,00" oninput="recalcularCusto()" disabled>
        </div>
        <div class="custo-item">
          <div class="custo-item-icon" style="background:rgba(0,212,255,0.15)">ðŸ”§</div>
          <div style="flex:1">
            <div class="custo-item-name">Custo extra</div>
            <div class="custo-item-sub">Pneu, guincho, outros...</div>
          </div>
          <div class="custo-toggle" id="toggle-manut" onclick="toggleCusto('manut')">+</div>
          <input type="number" class="custo-item-input" id="val-manut" placeholder="0,00" oninput="recalcularCusto()" disabled>
        </div>
        <div class="custo-total-row">
          <div class="custo-total-label">Total de custos</div>
          <div class="custo-total-val" id="custo-total-display">R$ 0,00</div>
        </div>
      </div>

      <input type="hidden" id="f-custo">

      <div class="lucro-preview" id="lucro-preview" style="display:none">
        <div>
          <div class="lucro-preview-label">Lucro estimado</div>
          <div style="font-size:11px;color:var(--muted);margin-top:2px">Frete âˆ’ Custos</div>
        </div>
        <div class="lucro-preview-val" id="lucro-preview-val">R$ 0</div>
      </div>

      <div class="form-group" style="margin-top:14px">
        <div class="form-label">ObservaÃ§Ãµes</div>
        <textarea id="f-obs" class="form-input" rows="2" placeholder="InformaÃ§Ãµes extras..."></textarea>
      </div>

      <div class="action-row" style="margin-top:16px">
        <button class="btn btn-primary" onclick="salvarEntrega()">ðŸ’¾ Salvar Entrega</button>
        <button class="btn btn-secondary btn-sm" onclick="limparForm()">ðŸ—‘</button>
      </div>
    </div>
  </div>

  <!-- EM ROTA / CHECKIN -->
  <div id="page-ativas" class="page">
    <div class="page-title">Controle de Viagem</div>
    <div class="page-subtitle" id="ativas-subtitle">Selecione uma entrega para iniciar</div>

    <!-- Viagem ativa (mostrado quando hÃ¡ viagem em andamento) -->
    <div id="viagem-ativa-container" style="display:none"></div>

    <!-- Lista de entregas disponÃ­veis para iniciar -->
    <div id="disponiveis-container">
      <div class="section-title">Entregas DisponÃ­veis</div>
      <div id="disponiveis-list"></div>
    </div>

    <!-- Painel de confirmaÃ§Ã£o/inÃ­cio de viagem -->
    <div id="viagem-confirma-container" style="display:none"></div>
  </div>

  <!-- HISTÃ“RICO -->
  <div id="page-historico" class="page">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px">
      <div class="page-title" style="margin:0">HistÃ³rico</div>
      <div style="display:flex;gap:8px">
        <select id="filtro-veiculo" onchange="renderHistorico()" class="form-input" style="padding:9px 12px;font-size:12px">
          <option value="">Todos os veÃ­culos</option>
          <option value="Gol - ABC1234">Gol</option>
          <option value="Saveiro - DEF5678">Saveiro</option>
          <option value="Fiorino - GHI9012">Fiorino</option>
        </select>
        <select id="filtro-status" onchange="renderHistorico()" class="form-input" style="padding:9px 12px;font-size:12px">
          <option value="">Todos os status</option>
          <option value="concluido">ConcluÃ­dos</option>
          <option value="em_rota">Em Rota</option>
          <option value="agendado">DisponÃ­veis</option>
        </select>
      </div>
    </div>
    <div class="card table-wrap">
      <table>
        <thead>
          <tr>
            <th>Data</th>
            <th>Rota</th>
            <th>Cliente</th>
            <th>Nota Fiscal</th>
            <th>Peso/Embalagem</th>
            <th>Frete</th>
            <th class="dono-only">Lucro</th>
            <th>Km</th>
            <th>Descarga</th>
            <th>Status</th>
            <th></th>
          </tr>
        </thead>
        <tbody id="historico-tbody"></tbody>
      </table>
      <div id="historico-empty" class="no-data" style="display:none">Nenhuma entrega encontrada</div>
    </div>
  </div>

  <!-- RANKINGS -->
  <div id="page-rankings" class="page">
    <div class="page-title">Rankings</div><div class="page-subtitle">AnÃ¡lise de performance da frota</div>
    <div style="display:grid;grid-template-columns:1fr;gap:14px">
      <div class="card">
        <div class="section-title" style="font-size:13px"><span class="dot" style="background:var(--accent)"></span>Melhores Rotas (Lucro/km)</div>
        <div id="rank-rotas"><div class="no-data">Dados insuficientes</div></div>
      </div>
      <div class="card">
        <div class="section-title" style="font-size:13px"><span class="dot" style="background:var(--accent2)"></span>Clientes Mais RentÃ¡veis</div>
        <div id="rank-clientes"><div class="no-data">Dados insuficientes</div></div>
      </div>
      <div class="card">
        <div class="section-title" style="font-size:13px"><span class="dot" style="background:var(--accent3)"></span>Performance por VeÃ­culo</div>
        <div id="rank-veiculos"><div class="no-data">Dados insuficientes</div></div>
      </div>
      <div class="card">
        <div class="section-title" style="font-size:13px"><span class="dot" style="background:var(--red)"></span>Clientes com Maior Tempo de Descarga</div>
        <div id="rank-descarga"><div class="no-data">Dados insuficientes</div></div>
      </div>
    </div>
  </div>

  <!-- PÃGINA DE CHECKLISTS (HISTÃ“RICO) -->
  <div id="page-checklists" class="page">
    <div class="page-title">ðŸ“‹ Checklists</div>
    <div class="page-subtitle">HistÃ³rico de inspeÃ§Ãµes realizadas</div>

    <div style="margin-bottom: 16px; display: flex; gap: 8px;">
      <select id="filtro-checklist-veiculo" class="form-input" style="flex: 1;" onchange="renderChecklistsHistorico()">
        <option value="">Todos os veÃ­culos</option>
      </select>
      <select id="filtro-checklist-motorista" class="form-input" style="flex: 1;" onchange="renderChecklistsHistorico()">
        <option value="">Todos os motoristas</option>
      </select>
    </div>

    <div id="checklists-historico-container">
      <div class="no-data">
        <div class="no-data-icon">ðŸ“‹</div>
        Nenhum checklist realizado ainda.
      </div>
    </div>
  </div>

</main>

  <!-- RASTREIO -->
  <div id="page-rastreio" class="page">

    <!-- SETUP FIREBASE (shown when not configured) -->
    <div id="rastreio-setup" style="max-width:560px;margin:0 auto">
      <div class="section-title"><span class="dot" style="background:var(--accent3)"></span>Rastreio em Tempo Real</div>
      <div class="firebase-setup">
        <h3>ðŸ“¡ Conectar ao Firebase</h3>

        <div style="background:#1a2e1a;border:1px solid #2a5a2a;border-radius:10px;padding:14px;margin-bottom:16px">
          <div style="font-size:11px;color:var(--accent);margin-bottom:6px;font-weight:500">âœ… Projeto configurado: <strong>fretemanager-60ef8</strong></div>
          <div style="font-size:10px;color:var(--muted)">Banco: fretemanager-60ef8-default-rtdb.firebaseio.com</div>
        </div>

        <div class="setup-step"><div class="setup-num" style="background:var(--accent);color:#000">!</div><div>Antes de conectar, certifique-se que as <strong style="color:var(--accent3)">Regras do banco</strong> estÃ£o publicadas no Firebase Console:</div></div>

        <div style="background:#080f08;border:1px solid var(--border);border-radius:8px;padding:12px;margin:10px 0;font-size:11px;color:var(--accent3);white-space:pre;overflow-x:auto">{
  "rules": {
    "rastreio":      { ".read": true, ".write": true },
    "historico_gps": { ".read": true, ".write": true },
    "alertas_parada":{ ".read": true, ".write": true },
    "dados":         { ".read": true, ".write": true }
  }
}</div>
        <div style="margin-bottom:14px">
          <a href="https://console.firebase.google.com/project/fretemanager-60ef8/database/fretemanager-60ef8-default-rtdb/rules" target="_blank"
             style="color:var(--accent3);font-size:11px;text-decoration:none">
            ðŸ”— Abrir pÃ¡gina de Regras no Firebase Console â†—
          </a>
        </div>

        <div class="firebase-input-group" style="display:none">
          <input type="text" id="fb-apiKey" value="AIzaSyARKsBG5LFy6L5-USZIgPxSz6sTlO79eU4">
          <input type="text" id="fb-authDomain" value="fretemanager-60ef8.firebaseapp.com">
          <input type="text" id="fb-databaseURL" value="https://fretemanager-60ef8-default-rtdb.firebaseio.com">
          <input type="text" id="fb-projectId" value="fretemanager-60ef8">
        </div>

        <div style="display:flex;gap:10px;margin-top:4px">
          <button class="btn" style="flex:1;padding:14px;font-size:14px" onclick="conectarFirebase()">
            ðŸ”Œ Conectar ao Firebase
          </button>
          <button class="btn btn-secondary" onclick="usarModoDemo()" style="font-size:11px">
            ðŸ§ª Demo
          </button>
        </div>
        <div id="fb-error" style="color:var(--red);font-size:11px;margin-top:10px;display:none"></div>
      </div>
    </div>

    <!-- MAIN RASTREIO (shown when configured) -->
    <div id="rastreio-main" style="display:none">
      <div id="alertas-parada-banner" style="display:none;margin-bottom:12px"></div>
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;flex-wrap:wrap;gap:10px">
        <div class="page-title" style="margin:0">Rastreio GPS</div>
        <div style="display:flex;align-items:center;gap:10px">
          <div class="firebase-connected" id="fb-status-badge">
            <div class="pulse-dot"></div>
            <span id="fb-status-text">Conectado ao Firebase</span>
          </div>
          <button class="btn btn-secondary btn-sm" onclick="desconectarFirebase()" style="font-size:11px">Desconectar</button>
        </div>
      </div>

      <div class="rastreio-layout">
        <!-- LEFT PANEL -->
        <div class="rastreio-panel">

          <!-- Dono panel (always visible) -->
          <div id="painel-dono">
            <div style="font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:0.8px;margin-bottom:8px">VeÃ­culos online</div>
            <div id="dono-vehicle-list">
              <div class="no-data" style="padding:14px">Aguardando veÃ­culos...</div>
            </div>
            <div style="margin-top:10px;font-size:10px;color:var(--muted);text-align:center">
              AtualizaÃ§Ã£o automÃ¡tica a cada 5s
            </div>
          </div>

          <!-- Motorista panel (hidden, kept for compatibility) -->
          <div id="painel-motorista" style="display:none">
            <div class="vehicle-selector" id="vehicle-selector-list"></div>
            <button class="btn tracking-btn" id="btn-tracking" onclick="toggleTracking()" style="display:none"></button>
            <div id="stat-velocidade" style="display:none"></div>
            <div id="stat-distancia" style="display:none"></div>
            <div id="stat-tempo-ativo" style="display:none"></div>
            <div id="gps-info" style="display:none"></div>
            <input type="number" id="stop-threshold-input" value="15" style="display:none">
          </div>

        </div>

        <!-- MAP -->
        <div class="map-container">
          <div id="map"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- FROTA - CORRIGIDA -->
  <div id="page-frota" class="page">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px">
      <div class="page-title" style="margin:0">Minha Frota</div>
      <button class="btn btn-primary btn-sm" onclick="abrirModalVeiculo()">+ VeÃ­culo</button>
    </div>
    <div id="frota-alertas" style="margin-bottom:16px"></div>
    <div class="frota-grid" id="frota-grid">
      <!-- VeÃ­culos serÃ£o renderizados aqui -->
    </div>
  </div>

<!-- MODAL VEÃCULO -->
<div class="modal-overlay" id="modal-veiculo">
  <div class="modal">
    <div class="modal-handle"></div>
    <div class="modal-title" id="modal-veiculo-title">Novo VeÃ­culo</div>
    <input type="hidden" id="mv-id">
    <div class="">
      <div class="form-group">
        <div class="form-label">Modelo / Nome</div>
        <input type="text" id="mv-modelo" class="form-input" placeholder="Ex: Fiorino, Saveiro, Sprinter...">
      </div>
      <div class="form-group">
        <div class="form-label">Ano</div>
        <input type="number" id="mv-ano" class="form-input" placeholder="Ex: 2019" min="1990" max="2030">
      </div>
      <div class="form-group">
        <div class="form-label">Placa</div>
        <input type="text" id="mv-placa" class="form-input" placeholder="Ex: ABC1D23" maxlength="8" style="text-transform:uppercase">
      </div>
      <div class="form-group">
        <div class="form-label">Tipo / Ãcone</div>
        <select id="mv-tipo" class="form-input">
          <option value="ðŸš—">ðŸš— Carro</option>
          <option value="ðŸ›»">ðŸ›» Picape</option>
          <option value="ðŸš">ðŸš Van / FurgÃ£o</option>
          <option value="ðŸšš">ðŸšš CaminhÃ£o</option>
          <option value="ðŸï¸">ðŸï¸ Moto</option>
        </select>
      </div>
      <div class="form-group">
        <div class="form-label">Consumo (km/litro)</div>
        <input type="number" id="mv-consumo" class="form-input" placeholder="Ex: 12.5" step="0.1" min="1">
      </div>
      <div class="form-group">
        <div class="form-label">Capacidade de Carga (kg)</div>
        <input type="number" id="mv-carga" class="form-input" placeholder="Ex: 600" min="1">
      </div>
      <div class="form-group">
        <div class="form-label">Ãšltima RevisÃ£o</div>
        <input type="date" id="mv-ultima-revisao" class="form-input">
      </div>
      <div class="form-group">
        <div class="form-label">PrÃ³xima RevisÃ£o</div>
        <input type="date" id="mv-proxima-revisao" class="form-input">
      </div>
      <div class="form-group full">
        <div class="form-label">ObservaÃ§Ãµes</div>
        <textarea id="mv-obs" class="form-input" rows="2" placeholder="Seguro, IPVA, observaÃ§Ãµes mecÃ¢nicas..."></textarea>
      </div>
    </div>
    <div class="modal-actions">
      <button class="btn btn-secondary" onclick="closeModal('modal-veiculo')" style="flex:1">Cancelar</button>
      <button class="btn btn-primary" onclick="salvarVeiculo()" style="flex:1">Salvar</button>
    </div>
  </div>
</div>

<!-- MODAL CHECKLIST DO VEÃCULO (NOVO) -->
<div class="modal-overlay" id="modal-checklist">
  <div class="modal" style="max-width: 500px; border-radius: 28px;">
    <div class="modal-handle"></div>
    <div class="modal-title" style="display: flex; align-items: center; gap: 10px; margin-bottom: 5px;">
      <span style="font-size: 28px;">ðŸ”§</span> 
      <span>Checklist do VeÃ­culo</span>
    </div>
    <div style="font-size: 12px; color: var(--text2); margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid var(--glass-border);">
      <span id="checklist-veiculo-info">Selecione um veÃ­culo</span>
    </div>

    <input type="hidden" id="checklist-veiculo-id">
    <input type="hidden" id="checklist-veiculo-placa">
    
    <!-- Lista de itens do checklist -->
    <div style="max-height: 350px; overflow-y: auto; padding-right: 5px; margin-bottom: 16px;" id="checklist-items-container">
      <!-- Itens serÃ£o gerados dinamicamente via JS -->
    </div>

    <!-- Campo de comentÃ¡rios -->
    <div class="form-group" style="margin-top: 10px;">
      <div class="form-label" style="display: flex; align-items: center; gap: 5px;">
        <span>ðŸ“</span> ObservaÃ§Ãµes / ComentÃ¡rios
      </div>
      <textarea id="checklist-comentarios" class="form-input" rows="2" placeholder="Algo fora do normal? Algum barulho estranho?"></textarea>
    </div>

    <!-- Ãrea de fotos -->
    <div style="margin: 15px 0;">
      <div class="form-label" style="display: flex; align-items: center; gap: 5px; margin-bottom: 10px;">
        <span>ðŸ“¸</span> Fotos do veÃ­culo
      </div>
      
      <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 10px;" id="checklist-fotos-preview">
        <!-- PrÃ©-visualizaÃ§Ã£o das fotos serÃ¡ inserida aqui -->
      </div>

      <div style="display: flex; gap: 8px;">
        <button type="button" class="btn btn-secondary btn-sm" onclick="checklistTirarFoto()" style="flex: 1; padding: 12px;">
          <span style="font-size: 18px;">ðŸ“·</span> Tirar Foto
        </button>
        <button type="button" class="btn btn-secondary btn-sm" onclick="checklistEscolherFoto()" style="flex: 1; padding: 12px;">
          <span style="font-size: 18px;">ðŸ–¼ï¸</span> Galeria
        </button>
      </div>
      <input type="file" id="checklist-foto-input" accept="image/*" style="display: none" onchange="checklistOnFotoSelected(event)">
    </div>

    <!-- AÃ§Ãµes -->
    <div class="modal-actions" style="margin-top: 20px;">
      <button class="btn btn-secondary" onclick="fecharModalChecklist()" style="flex: 1">Cancelar</button>
      <button class="btn btn-primary" onclick="salvarChecklist()" style="flex: 2">âœ… Concluir Checklist</button>
    </div>
  </div>
</div>

<div class="modal-overlay" id="modal-delete">
  <div class="modal">
    <div class="modal-handle"></div><div class="modal-title">Excluir entrega?</div>
    <p style="color:var(--muted);font-size:12px">Esta aÃ§Ã£o nÃ£o pode ser desfeita.</p>
    <div class="modal-actions">
      <button class="btn btn-secondary" onclick="closeModal('modal-delete')" style="flex:1">Cancelar</button>
      <button class="btn btn-danger" onclick="confirmarDelete()" style="flex:1;background:rgba(255,68,102,0.2);border:1px solid var(--red);color:var(--red)">Excluir</button>
    </div>
  </div>
</div>

<script>
// ============================================
// CONFIGURAÃ‡ÃƒO DO FIREBASE
// ============================================
const FB_CONFIG = {
  apiKey: "AIzaSyARKsBG5LFy6L5-USZIgPxSz6sTlO79eU4",
  authDomain: "fretemanager-60ef8.firebaseapp.com",
  databaseURL: "https://fretemanager-60ef8-default-rtdb.firebaseio.com",
  projectId: "fretemanager-60ef8",
  storageBucket: "fretemanager-60ef8.firebasestorage.app",
  messagingSenderId: "977410315261",
  appId: "1:977410315261:web:ebaf0794c7d887321abf94"
};

// ============================================
// VARIÃVEIS GLOBAIS
// ============================================
let fbApp = null;
let fbDb = null;
let fbAuth = null;
let currentUser = null;
let entregas = [];
let veiculos = [];
let funcionariosCache = [];
let notasFiscais = [];
let editVeiculoId = null;

// ============================================
// INICIALIZAÃ‡ÃƒO DO FIREBASE
// ============================================
function initFirebase() {
  console.log("Inicializando Firebase...");
  
  if (fbApp) {
    console.log("Firebase jÃ¡ inicializado");
    return;
  }
  
  try {
    fbApp = firebase.initializeApp(FB_CONFIG);
    fbDb = firebase.database();
    fbAuth = firebase.auth();
    
    console.log("Firebase inicializado com sucesso!");
    
    fbAuth.onAuthStateChanged(async (user) => {
      console.log("Auth state changed:", user ? user.email : "null");
      
      if (user) {
        try {
          const snapshot = await fbDb.ref('usuariosGlobais/' + user.uid).once('value');
          const profile = snapshot.val();
          
          if (profile) {
            console.log("Perfil carregado:", profile);
            
            if (profile.status !== 'ativo') {
              await fbAuth.signOut();
              showAuthError('â›” UsuÃ¡rio inativo. Entre em contato com o suporte.');
              return;
            }
            
            currentUser = { uid: user.uid, email: user.email, ...profile };
            
            document.getElementById('app-empresa-nome').textContent = profile.empresaNome || 'FreteManager';
            document.getElementById('app-user-tipo').textContent = profile.tipo === 'dono' ? 'ðŸ‘‘ Dono' : 'ðŸ‘· FuncionÃ¡rio';
            document.getElementById('avatar-nome-display').textContent = profile.nome || profile.email;
            document.getElementById('avatar-user-email').textContent = profile.email;
            
            hideAuthScreen();
            carregarDadosFirebase();
            
            if (profile.tipo === 'funcionario') {
              applyFuncRestrictions();
              showPage('func');
            } else {
              removeFuncRestrictions();
              showPage('dashboard');
            }
            
          } else {
            console.error("Perfil nÃ£o encontrado");
            await fbAuth.signOut();
            showAuthError("Perfil nÃ£o encontrado. FaÃ§a cadastro novamente.");
          }
        } catch (error) {
          console.error("Erro ao carregar perfil:", error);
          showAuthError("Erro ao carregar perfil. Tente novamente.");
        }
      } else {
        console.log("UsuÃ¡rio deslogado");
        currentUser = null;
        entregas = [];
        veiculos = [];
        showAuthScreen();
      }
    });
    
  } catch (error) {
    console.error("Erro ao inicializar Firebase:", error);
    showAuthError("Erro ao conectar com servidor. Verifique sua internet.");
  }
}

// ============================================
// FUNÃ‡Ã•ES DE AUTENTICAÃ‡ÃƒO
// ============================================
function showAuthScreen() {
  const authScreen = document.getElementById('auth-screen');
  if (authScreen) {
    authScreen.style.display = 'flex';
    document.body.style.overflow = 'hidden';
  }
  authTab('login');
}

function hideAuthScreen() {
  const authScreen = document.getElementById('auth-screen');
  if (authScreen) {
    authScreen.style.display = 'none';
    document.body.style.overflow = 'auto';
  }
}

function authTab(tab) {
  document.getElementById('auth-form-login').style.display = tab === 'login' ? 'flex' : 'none';
  document.getElementById('auth-form-cadastro').style.display = tab === 'cadastro' ? 'flex' : 'none';
  clearAuthMsg();
}

function clearAuthMsg() {
  document.getElementById('auth-error').style.display = 'none';
  document.getElementById('auth-success').style.display = 'none';
}

function showAuthError(msg) {
  const el = document.getElementById('auth-error');
  if (el) {
    el.textContent = msg;
    el.style.display = 'block';
  }
  document.getElementById('auth-success').style.display = 'none';
}

function showAuthSuccess(msg) {
  const el = document.getElementById('auth-success');
  if (el) {
    el.textContent = msg;
    el.style.display = 'block';
  }
  document.getElementById('auth-error').style.display = 'none';
}

async function fazerLogin() {
  console.log("Iniciando login...");
  
  const email = document.getElementById('l-email').value.trim();
  const senha = document.getElementById('l-senha').value;
  
  if (!email || !senha) {
    showAuthError('Preencha e-mail e senha.');
    return;
  }
  
  const btn = document.getElementById('btn-login');
  btn.disabled = true;
  btn.innerHTML = '<span class="auth-spinner"></span>Entrando...';
  clearAuthMsg();
  
  try {
    await fbAuth.signInWithEmailAndPassword(email, senha);
  } catch (error) {
    console.error("Erro no login:", error);
    
    const msgs = {
      'auth/user-not-found': 'E-mail nÃ£o cadastrado.',
      'auth/wrong-password': 'Senha incorreta.',
      'auth/invalid-email': 'E-mail invÃ¡lido.',
      'auth/too-many-requests': 'Muitas tentativas. Aguarde alguns minutos.',
      'auth/invalid-credential': 'E-mail ou senha incorretos.',
      'auth/network-request-failed': 'Sem conexÃ£o com a internet.'
    };
    
    showAuthError(msgs[error.code] || 'Erro: ' + error.message);
    btn.disabled = false;
    btn.innerHTML = 'ðŸ”“ Entrar';
  }
}

async function fazerCadastro() {
  console.log("Iniciando cadastro...");
  
  const empresa = document.getElementById('c-empresa')?.value?.trim().slice(0, 50) || '';
  const nome = document.getElementById('c-nome')?.value?.trim() || '';
  const email = document.getElementById('c-email')?.value?.trim() || '';
  const senha = document.getElementById('c-senha')?.value || '';
  
  if (!empresa) { showAuthError('Informe o nome da empresa.'); return; }
  if (!nome) { showAuthError('Informe seu nome.'); return; }
  if (!email) { showAuthError('Informe o e-mail.'); return; }
  if (senha.length < 6) { showAuthError('Senha deve ter pelo menos 6 caracteres.'); return; }
  
  const btn = document.getElementById('btn-cadastro');
  btn.disabled = true;
  btn.innerHTML = '<span class="auth-spinner"></span>Criando conta...';
  clearAuthMsg();
  
  try {
    const cred = await fbAuth.createUserWithEmailAndPassword(email, senha);
    const uid = cred.user.uid;
    const empresaId = uid;
    
    const profile = {
      nome,
      email,
      tipo: 'dono',
      empresaId,
      empresaNome: empresa,
      status: 'ativo',
      criadoEm: Date.now()
    };
    
    await fbDb.ref('usuariosGlobais/' + uid).set(profile);
    
    console.log("Cadastro concluÃ­do com sucesso!");
    showAuthSuccess("Conta criada com sucesso! FaÃ§a login.");
    
    setTimeout(() => {
      authTab('login');
      btn.disabled = false;
      btn.innerHTML = 'âœ… Criar conta de empresa';
    }, 2000);
    
  } catch (error) {
    console.error("Erro no cadastro:", error);
    
    const msgs = {
      'auth/email-already-in-use': 'E-mail jÃ¡ cadastrado. FaÃ§a login.',
      'auth/invalid-email': 'E-mail invÃ¡lido.',
      'auth/weak-password': 'Senha muito fraca (mÃ­nimo 6 caracteres).',
      'auth/network-request-failed': 'Erro de rede. Verifique sua conexÃ£o.'
    };
    
    showAuthError(msgs[error.code] || 'Erro: ' + error.message);
    btn.disabled = false;
    btn.innerHTML = 'âœ… Criar conta de empresa';
  }
}

async function fazerLogout() {
  if (!confirm('Sair da conta?')) return;
  await fbAuth.signOut();
}

// ============================================
// FUNÃ‡Ã•ES DE RESTRIÃ‡Ã•ES
// ============================================
function applyFuncRestrictions() {
  ['nav-nova','nav-historico','nav-rankings','nav-dashboard','nav-equipe','nav-rastreio','nav-checklists'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.style.display = 'none';
  });

  const fn = document.getElementById('nav-func');
  if (fn) fn.style.display = 'flex';
}

function removeFuncRestrictions() {
  ['nav-nova','nav-historico','nav-rankings','nav-dashboard','nav-equipe','nav-rastreio','nav-checklists'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.style.display = 'flex';
  });
}

// ============================================
// FUNÃ‡Ã•ES DE NAVEGAÃ‡ÃƒO
// ============================================
function showPage(page) {
  document.querySelectorAll('.page').forEach(el => el.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
  
  const targetPage = document.getElementById('page-' + page);
  if (targetPage) targetPage.classList.add('active');
  
  const navEl = document.getElementById('nav-' + page);
  if (navEl) navEl.classList.add('active');
  
  // Renderizar pÃ¡gina especÃ­fica
  if (page === 'frota') {
    renderFrota();
  }
  if (page === 'equipe') {
    carregarFuncionarios();
  }
  
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function showPageFunc() {
  showPage('func');
  renderFuncDashboard();
}

// ============================================
// FUNÃ‡Ã•ES DE DASHBOARD
// ============================================
function renderDashboard() {
  console.log("Dashboard renderizado");
}

function renderFuncDashboard() {
  console.log("Dashboard do funcionÃ¡rio renderizado");
}

// ============================================
// CARREGAR DADOS DO FIREBASE
// ============================================
function carregarDadosFirebase() {
  if (!fbDb || !currentUser) return;
  
  console.log("Carregando dados...");
  
  const basePath = 'empresas/' + currentUser.empresaId;
  
  fbDb.ref(basePath + '/entregas').once('value', (snapshot) => {
    const dados = snapshot.val();
    if (dados && Array.isArray(dados)) {
      entregas = dados;
      console.log("Entregas carregadas:", entregas.length);
    }
  });
  
  fbDb.ref(basePath + '/veiculos').once('value', (snapshot) => {
    const dados = snapshot.val();
    if (dados && Array.isArray(dados)) {
      veiculos = dados;
      console.log("VeÃ­culos carregados:", veiculos.length);
      renderFrota();
      syncFrotaSelects();
    }
  });
  
  // Escutar mudanÃ§as em tempo real
  fbDb.ref(basePath + '/veiculos').on('value', (snapshot) => {
    const dados = snapshot.val();
    if (dados && Array.isArray(dados)) {
      veiculos = dados;
      renderFrota();
      syncFrotaSelects();
    }
  });
}

// ============================================
// FUNÃ‡Ã•ES DE FROTA
// ============================================
function saveVeiculos() {
  if (fbDb && currentUser) {
    fbDb.ref('empresas/' + currentUser.empresaId + '/veiculos').set(veiculos)
      .then(() => console.log("VeÃ­culos salvos no Firebase"))
      .catch(err => console.error("Erro ao salvar veÃ­culos:", err));
  }
}

function abrirModalVeiculo(id = null) {
  editVeiculoId = id;
  
  if (id) {
    const veiculo = veiculos.find(v => v.id === id);
    if (veiculo) {
      document.getElementById('modal-veiculo-title').textContent = 'Editar VeÃ­culo';
      document.getElementById('mv-id').value = veiculo.id;
      document.getElementById('mv-modelo').value = veiculo.modelo || '';
      document.getElementById('mv-ano').value = veiculo.ano || '';
      document.getElementById('mv-placa').value = veiculo.placa || '';
      document.getElementById('mv-tipo').value = veiculo.tipo || 'ðŸš—';
      document.getElementById('mv-consumo').value = veiculo.consumo || '';
      document.getElementById('mv-carga').value = veiculo.carga || '';
      document.getElementById('mv-ultima-revisao').value = veiculo.ultimaRevisao || '';
      document.getElementById('mv-proxima-revisao').value = veiculo.proximaRevisao || '';
      document.getElementById('mv-obs').value = veiculo.obs || '';
    }
  } else {
    document.getElementById('modal-veiculo-title').textContent = 'Novo VeÃ­culo';
    document.getElementById('mv-id').value = '';
    document.getElementById('mv-modelo').value = '';
    document.getElementById('mv-ano').value = '';
    document.getElementById('mv-placa').value = '';
    document.getElementById('mv-tipo').value = 'ðŸš—';
    document.getElementById('mv-consumo').value = '';
    document.getElementById('mv-carga').value = '';
    document.getElementById('mv-ultima-revisao').value = '';
    document.getElementById('mv-proxima-revisao').value = '';
    document.getElementById('mv-obs').value = '';
  }
  
  document.getElementById('modal-veiculo').classList.add('open');
}

function salvarVeiculo() {
  const modelo = document.getElementById('mv-modelo').value.trim();
  const placa = document.getElementById('mv-placa').value.trim().toUpperCase();
  
  if (!modelo) {
    alert('Informe o modelo do veÃ­culo.');
    return;
  }
  
  if (!placa) {
    alert('Informe a placa do veÃ­culo.');
    return;
  }
  
  const veiculo = {
    id: editVeiculoId || Date.now(),
    modelo,
    ano: document.getElementById('mv-ano').value,
    placa,
    tipo: document.getElementById('mv-tipo').value,
    consumo: parseFloat(document.getElementById('mv-consumo').value) || null,
    carga: parseFloat(document.getElementById('mv-carga').value) || null,
    ultimaRevisao: document.getElementById('mv-ultima-revisao').value,
    proximaRevisao: document.getElementById('mv-proxima-revisao').value,
    obs: document.getElementById('mv-obs').value
  };
  
  if (editVeiculoId) {
    const index = veiculos.findIndex(v => v.id === editVeiculoId);
    if (index !== -1) {
      veiculos[index] = veiculo;
    }
  } else {
    veiculos.push(veiculo);
  }
  
  saveVeiculos();
  closeModal('modal-veiculo');
  renderFrota();
  syncFrotaSelects();
  showToast('âœ… VeÃ­culo salvo com sucesso!');
}

function deletarVeiculo(id) {
  if (!confirm('Tem certeza que deseja excluir este veÃ­culo?')) return;
  
  veiculos = veiculos.filter(v => v.id !== id);
  saveVeiculos();
  renderFrota();
  syncFrotaSelects();
  showToast('ðŸ—‘ï¸ VeÃ­culo removido');
}

function renderFrota() {
  const grid = document.getElementById('frota-grid');
  if (!grid) return;
  
  if (!veiculos.length) {
    grid.innerHTML = `
      <div class="frota-add-btn" onclick="abrirModalVeiculo()">
        <div class="frota-add-plus">ï¼‹</div>
        <div>Adicionar VeÃ­culo</div>
      </div>
    `;
    return;
  }
  
  const hoje = new Date();
  hoje.setHours(0, 0, 0, 0);
  
  const alertas = veiculos.filter(v => v.proximaRevisao).map(v => {
    const revisao = new Date(v.proximaRevisao);
    revisao.setHours(0, 0, 0, 0);
    const dias = Math.ceil((revisao - hoje) / (1000 * 60 * 60 * 24));
    
    if (dias < 0) {
      return `<div class="alert-strip red">ðŸ”´ <strong>${v.modelo} (${v.placa})</strong> â€” RevisÃ£o vencida hÃ¡ ${Math.abs(dias)} dia(s)!</div>`;
    } else if (dias <= 15) {
      return `<div class="alert-strip">ðŸŸ¡ <strong>${v.modelo} (${v.placa})</strong> â€” RevisÃ£o em ${dias} dia(s)</div>`;
    }
    return null;
  }).filter(a => a !== null);
  
  document.getElementById('frota-alertas').innerHTML = alertas.join('');
  
  grid.innerHTML = veiculos.map(v => {
    let revisaoClass = '', revisaoText = '';
    let dias = 0;
    if (v.proximaRevisao) {
      const revisao = new Date(v.proximaRevisao);
      revisao.setHours(0, 0, 0, 0);
      dias = Math.ceil((revisao - hoje) / (1000 * 60 * 60 * 24));
      
      if (dias < 0) {
        revisaoClass = 'revisao-badge-late';
        revisaoText = `Vencida hÃ¡ ${Math.abs(dias)} dias`;
      } else if (dias <= 15) {
        revisaoClass = 'revisao-badge-warn';
        revisaoText = `${dias} dias`;
      } else {
        revisaoClass = 'revisao-badge-ok';
        revisaoText = `${dias} dias`;
      }
    }
    
    return `
      <div class="frota-card">
        <div class="frota-card-top">
          <div class="frota-card-icon">${v.tipo || 'ðŸš—'}</div>
          <div>
            <div class="frota-card-name">${v.modelo}</div>
            <div class="frota-card-year">${v.ano ? 'Ano ' + v.ano : ''}</div>
          </div>
          <div class="frota-plate">${v.placa}</div>
        </div>
        
        <div class="frota-specs">
          <div class="frota-spec">
            <div class="frota-spec-label">â›½ Consumo</div>
            <div class="frota-spec-value">${v.consumo ? v.consumo + ' km/l' : 'â€”'}</div>
          </div>
          <div class="frota-spec">
            <div class="frota-spec-label">ðŸ“¦ Cap. Carga</div>
            <div class="frota-spec-value">${v.carga ? v.carga + ' kg' : 'â€”'}</div>
          </div>
        </div>
        
        ${v.proximaRevisao ? `
          <div class="frota-revisao">
            <div style="display:flex;justify-content:space-between;margin-bottom:5px">
              <span style="font-size:12px">ðŸ”§ PrÃ³xima RevisÃ£o</span>
              <span class="${revisaoClass}">${revisaoText}</span>
            </div>
            <div class="progress-track">
              <div class="progress-fill" style="width:${Math.min(100, Math.abs(dias) * 5)}%;background:${dias < 0 ? '#f56060' : dias <= 15 ? '#f5a623' : '#c8f560'}"></div>
            </div>
            <div style="display:flex;justify-content:space-between;font-size:10px;color:var(--text2);margin-top:5px">
              <span>Ãšltima: ${v.ultimaRevisao ? v.ultimaRevisao.split('-').reverse().join('/') : 'â€”'}</span>
              <span>PrÃ³xima: ${v.proximaRevisao.split('-').reverse().join('/')}</span>
            </div>
          </div>
        ` : ''}
        
        ${v.obs ? `
          <div style="margin:0 18px 14px;padding:10px 12px;background:rgba(255,255,255,0.04);border-radius:12px;font-size:12px;color:var(--text2)">
            ðŸ“ ${v.obs}
          </div>
        ` : ''}
        
        <div class="frota-footer">
          <button class="btn btn-secondary btn-sm" style="flex:1" onclick="abrirModalVeiculo(${v.id})">âœï¸ Editar</button>
          <button class="btn btn-danger btn-sm" onclick="deletarVeiculo(${v.id})">ðŸ—‘ï¸</button>
        </div>
      </div>
    `;
  }).join('') + `
    <div class="frota-add-btn" onclick="abrirModalVeiculo()">
      <div class="frota-add-plus">ï¼‹</div>
      <div>Adicionar VeÃ­culo</div>
    </div>
  `;
}

function syncFrotaSelects() {
  const select = document.getElementById('func-veiculo-select');
  if (!select) return;
  
  select.innerHTML = '<option value="">Selecione sua placa...</option>' +
    veiculos.map(v => `<option value="${v.placa}">${v.modelo} â€” ${v.placa}</option>`).join('');
}

// ============================================
// FUNÃ‡Ã•ES DE EQUIPE - CORRIGIDAS (SEM ERRO DE PERMISSÃƒO)
// ============================================
async function carregarFuncionarios() {
  if (!fbDb || !currentUser) return;
  
  try {
    // Buscar todos os usuÃ¡rios (vamos filtrar localmente)
    const snapshot = await fbDb.ref('usuariosGlobais').once('value');
    const todosUsuarios = snapshot.val() || {};
    
    // Filtrar apenas funcionÃ¡rios da empresa atual
    funcionariosCache = Object.entries(todosUsuarios)
      .filter(([uid, perfil]) => perfil.empresaId === currentUser.empresaId && perfil.tipo === 'funcionario')
      .map(([uid, perfil]) => ({ uid, ...perfil }));
    
    renderEquipe();
    
  } catch (error) {
    console.error("Erro ao carregar funcionÃ¡rios:", error);
    showToast('âŒ Erro ao carregar lista de funcionÃ¡rios');
  }
}

function renderEquipe() {
  const lista = document.getElementById('equipe-lista');
  if (!lista) return;
  
  if (!funcionariosCache.length) {
    lista.innerHTML = '<div class="no-data"><div class="no-data-icon">ðŸ‘¥</div>Nenhum funcionÃ¡rio cadastrado ainda.</div>';
    return;
  }
  
  lista.innerHTML = funcionariosCache.map(f => `
    <div class="func-card">
      <div class="func-avatar-sm" style="background:rgba(0,212,255,.1)">ðŸ‘·</div>
      <div class="func-info">
        <div class="func-nome">${f.nome}</div>
        <div class="func-email">${f.email}</div>
        <div class="func-veiculo-tag">Status: <span class="badge ${f.status === 'ativo' ? 'badge-success' : 'badge-danger'}">${f.status === 'ativo' ? 'Ativo' : 'Inativo'}</span></div>
      </div>
    </div>
  `).join('');
}

function toggleAddFunc() {
  const panel = document.getElementById('add-func-panel');
  if (panel) panel.classList.toggle('hidden');
}

async function criarFuncionario() {
  const nome = document.getElementById('nf-nome')?.value?.trim();
  const email = document.getElementById('nf-email')?.value?.trim();
  const senha = document.getElementById('nf-senha')?.value;
  
  if (!nome) { showToast('âš ï¸ Informe o nome'); return; }
  if (!email) { showToast('âš ï¸ Informe o e-mail'); return; }
  if (!senha || senha.length < 6) { showToast('âš ï¸ Senha com mÃ­nimo 6 caracteres'); return; }
  
  const btn = document.getElementById('btn-add-func');
  const originalText = btn.innerHTML;
  btn.disabled = true;
  btn.innerHTML = '<span class="auth-spinner"></span>Criando...';
  
  try {
    // Criar usuÃ¡rio no Authentication
    const cred = await fbAuth.createUserWithEmailAndPassword(email, senha);
    const uid = cred.user.uid;
    
    const profile = {
      nome,
      email,
      tipo: 'funcionario',
      empresaId: currentUser.empresaId,
      empresaNome: currentUser.empresaNome,
      status: 'ativo',
      criadoEm: Date.now()
    };
    
    // Salvar em usuariosGlobais (Ãºnico caminho com permissÃ£o)
    await fbDb.ref('usuariosGlobais/' + uid).set(profile);
    
    // Limpar o formulÃ¡rio
    document.getElementById('nf-nome').value = '';
    document.getElementById('nf-email').value = '';
    document.getElementById('nf-senha').value = '';
    
    // Fechar o painel
    toggleAddFunc();
    
    // Mostrar mensagem de sucesso
    showToast('âœ… ' + nome + ' adicionado com sucesso!');
    
    // Recarregar lista
    await carregarFuncionarios();
    
  } catch (error) {
    console.error("Erro ao criar funcionÃ¡rio:", error);
    
    // Mensagens de erro amigÃ¡veis
    if (error.code === 'auth/email-already-in-use') {
      showToast('âŒ Este e-mail jÃ¡ estÃ¡ em uso');
    } else if (error.code === 'auth/invalid-email') {
      showToast('âŒ E-mail invÃ¡lido');
    } else if (error.code === 'auth/weak-password') {
      showToast('âŒ Senha muito fraca');
    } else {
      showToast('âŒ Erro ao criar funcionÃ¡rio: ' + (error.message || 'Tente novamente'));
    }
    
  } finally {
    btn.disabled = false;
    btn.innerHTML = originalText;
  }
}

// ============================================
// FUNÃ‡Ã•ES PARA NOTAS FISCAIS
// ============================================
function adicionarCampoNota(valor = '') {
  const container = document.getElementById('notas-fiscais-container');
  if (!container) return;
  
  const index = notasFiscais.length;
  
  const notaDiv = document.createElement('div');
  notaDiv.className = 'nota-item';
  notaDiv.innerHTML = `
    <input type="text" class="nota-numero" placeholder="NÃºmero da nota fiscal" value="${valor}" oninput="atualizarNotasFiscais(${index}, this.value)">
    <div class="nota-remove" onclick="removerNotaFiscal(${index})">âœ•</div>
  `;
  
  container.appendChild(notaDiv);
  notasFiscais.push(valor);
  atualizarHiddenNotas();
}

function removerNotaFiscal(index) {
  const container = document.getElementById('notas-fiscais-container');
  if (!container) return;
  
  container.innerHTML = '';
  notasFiscais.splice(index, 1);
  
  notasFiscais.forEach((valor, i) => {
    adicionarCampoNota(valor);
  });
  
  atualizarHiddenNotas();
}

function atualizarNotasFiscais(index, valor) {
  notasFiscais[index] = valor;
  atualizarHiddenNotas();
}

function atualizarHiddenNotas() {
  const notasValidas = notasFiscais.filter(n => n && n.trim() !== '');
  const input = document.getElementById('f-notas');
  if (input) input.value = JSON.stringify(notasValidas);
}

// ============================================
// FUNÃ‡Ã•ES DE FORMULÃRIO
// ============================================
function limparForm() {
  ['f-data','f-origem','f-destino','f-cliente','f-carga','f-valor','f-km','f-obs'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.value = '';
  });
  
  const hoje = new Date().toISOString().split('T')[0];
  const dataEl = document.getElementById('f-data');
  if (dataEl) dataEl.value = hoje;
  
  notasFiscais = [];
  const container = document.getElementById('notas-fiscais-container');
  if (container) container.innerHTML = '';
  const notasInput = document.getElementById('f-notas');
  if (notasInput) notasInput.value = '[]';
  
  const pesoEl = document.getElementById('f-peso');
  if (pesoEl) pesoEl.value = '';
  const embalagemEl = document.getElementById('f-embalagem');
  if (embalagemEl) embalagemEl.value = '';
  const horarioEl = document.getElementById('f-horario-recebimento');
  if (horarioEl) horarioEl.value = '';
}

function salvarEntrega() {
  const data = document.getElementById('f-data')?.value;
  const origem = document.getElementById('f-origem')?.value?.trim();
  const destino = document.getElementById('f-destino')?.value?.trim();
  const cliente = document.getElementById('f-cliente')?.value?.trim();
  
  if (!data || !origem || !destino || !cliente) {
    alert('Preencha os campos obrigatÃ³rios.');
    return;
  }
  
  const notasValidas = notasFiscais.filter(n => n && n.trim() !== '');
  
  const entrega = {
    id: Date.now(),
    data,
    origem,
    destino,
    cliente,
    notasFiscais: notasValidas,
    peso: parseFloat(document.getElementById('f-peso')?.value) || null,
    embalagem: document.getElementById('f-embalagem')?.value || '',
    horarioRecebimento: document.getElementById('f-horario-recebimento')?.value || '',
    carga: document.getElementById('f-carga')?.value || '',
    valor: parseFloat(document.getElementById('f-valor')?.value) || 0,
    km: parseFloat(document.getElementById('f-km')?.value) || 0,
    obs: document.getElementById('f-obs')?.value || '',
    status: document.getElementById('f-status')?.value || 'agendado'
  };
  
  entregas.unshift(entrega);
  
  if (fbDb && currentUser) {
    fbDb.ref('empresas/' + currentUser.empresaId + '/entregas').set(entregas);
  }
  
  limparForm();
  alert('Entrega salva com sucesso!');
}

// ============================================
// FUNÃ‡Ã•ES DE CUSTO
// ============================================
function recalcularCusto() {}
function toggleCusto(tipo) {}
function salvarConfigCusto() {}

// ============================================
// FUNÃ‡Ã•ES DE AVATAR
// ============================================
function toggleAvatarMenu() {
  const modal = document.getElementById('avatar-modal');
  if (modal) modal.classList.toggle('open');
}

function fecharAvatarMenu() {
  const modal = document.getElementById('avatar-modal');
  if (modal) modal.classList.remove('open');
}

function escolherFoto() {
  const input = document.getElementById('avatar-file-input');
  if (input) input.click();
  fecharAvatarMenu();
}

function tirarFoto() {
  const input = document.getElementById('avatar-file-input');
  if (input) {
    input.setAttribute('capture', 'user');
    input.click();
  }
  fecharAvatarMenu();
}

function onAvatarFileSelected(event) {
  const file = event.target.files[0];
  if (!file) return;
  
  const reader = new FileReader();
  reader.onload = function(e) {
    localStorage.setItem('fm_avatar', e.target.result);
    renderAvatar();
  };
  reader.readAsDataURL(file);
}

function removerFoto() {
  localStorage.removeItem('fm_avatar');
  renderAvatar();
  fecharAvatarMenu();
}

function renderAvatar() {
  const saved = localStorage.getItem('fm_avatar');
  const avatarEl = document.getElementById('header-avatar');
  const emojiEl = document.getElementById('avatar-emoji');
  
  if (!avatarEl || !emojiEl) return;
  
  const oldImg = avatarEl.querySelector('img');
  if (oldImg) oldImg.remove();
  
  if (saved) {
    emojiEl.style.display = 'none';
    const img = document.createElement('img');
    img.src = saved;
    img.style.cssText = 'position:absolute;inset:0;width:100%;height:100%;object-fit:cover;border-radius:50%;z-index:1';
    avatarEl.insertBefore(img, avatarEl.firstChild);
  } else {
    emojiEl.style.display = 'block';
  }
}

// ============================================
// FUNÃ‡Ã•ES DE UTILIDADE
// ============================================
function contarEmpresa() {
  const v = document.getElementById('c-empresa')?.value || '';
  const el = document.getElementById('empresa-chars');
  if (el) {
    el.textContent = v.length + ' / 50';
    el.classList.toggle('warn', v.length > 40);
  }
}

function showToast(msg) {
  let t = document.getElementById('app-toast');
  if (!t) {
    t = document.createElement('div');
    t.id = 'app-toast';
    t.style.cssText = 'position:fixed;bottom:90px;left:50%;transform:translateX(-50%);background:#1e2a40;border:1px solid var(--glass-border);color:var(--text);padding:10px 20px;border-radius:20px;font-size:13px;z-index:9999;transition:opacity .3s;white-space:nowrap;font-family:Outfit,sans-serif;pointer-events:none';
    document.body.appendChild(t);
  }
  t.textContent = msg;
  t.style.opacity = '1';
  clearTimeout(t._to);
  t._to = setTimeout(() => t.style.opacity = '0', 2800);
}

function closeModal(id) {
  const modal = document.getElementById(id);
  if (modal) modal.classList.remove('open');
}

// ============================================
// FUNÃ‡Ã•ES DE HISTÃ“RICO E RANKINGS
// ============================================
function renderHistorico() {}
function renderRankings() {}
function renderAtivas() {}
function renderChecklistsHistorico() {}
function atualizarFiltrosChecklist() {}
function abrirChecklistVeiculo() {
  showToast('ðŸ”§ Checklist em desenvolvimento');
}
function funcSelecionarVeiculo() {}
function funcLimparVeiculo() {}

// ============================================
// FUNÃ‡Ã•ES DE RASTREIO
// ============================================
function conectarFirebase() {
  showToast('ðŸ”Œ Firebase jÃ¡ estÃ¡ conectado');
}
function usarModoDemo() {
  showToast('ðŸ§ª Modo demo ativado');
}
function desconectarFirebase() {
  showToast('ðŸ”Œ Desconectado');
}
function initRastreioPage() {}
function toggleTracking() {}

// ============================================
// INICIALIZAÃ‡ÃƒO
// ============================================
document.addEventListener('DOMContentLoaded', function() {
  console.log("DOM carregado, iniciando aplicaÃ§Ã£o...");
  
  initFirebase();
  
  const hoje = new Date().toISOString().split('T')[0];
  const dataInput = document.getElementById('f-data');
  if (dataInput) dataInput.value = hoje;
  
  setTimeout(() => {
    if (document.getElementById('notas-fiscais-container')) {
      adicionarCampoNota();
    }
  }, 500);
  
  renderAvatar();
});

// Exportar funÃ§Ãµes para o escopo global
window.fazerLogin = fazerLogin;
window.fazerCadastro = fazerCadastro;
window.fazerLogout = fazerLogout;
window.authTab = authTab;
window.contarEmpresa = contarEmpresa;
window.showPage = showPage;
window.showPageFunc = showPageFunc;
window.toggleAddFunc = toggleAddFunc;
window.criarFuncionario = criarFuncionario;
window.adicionarCampoNota = adicionarCampoNota;
window.removerNotaFiscal = removerNotaFiscal;
window.atualizarNotasFiscais = atualizarNotasFiscais;
window.limparForm = limparForm;
window.salvarEntrega = salvarEntrega;
window.recalcularCusto = recalcularCusto;
window.toggleCusto = toggleCusto;
window.salvarConfigCusto = salvarConfigCusto;
window.abrirChecklistVeiculo = abrirChecklistVeiculo;
window.toggleAvatarMenu = toggleAvatarMenu;
window.fecharAvatarMenu = fecharAvatarMenu;
window.escolherFoto = escolherFoto;
window.tirarFoto = tirarFoto;
window.onAvatarFileSelected = onAvatarFileSelected;
window.removerFoto = removerFoto;
window.closeModal = closeModal;
window.conectarFirebase = conectarFirebase;
window.usarModoDemo = usarModoDemo;
window.desconectarFirebase = desconectarFirebase;
window.renderHistorico = renderHistorico;
window.renderRankings = renderRankings;
window.renderAtivas = renderAtivas;
window.renderChecklistsHistorico = renderChecklistsHistorico;
window.atualizarFiltrosChecklist = atualizarFiltrosChecklist;
window.funcSelecionarVeiculo = funcSelecionarVeiculo;
window.funcLimparVeiculo = funcLimparVeiculo;
window.abrirModalVeiculo = abrirModalVeiculo;
window.salvarVeiculo = salvarVeiculo;
window.deletarVeiculo = deletarVeiculo;
</script>
</body>
</html>